<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
 <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Antomani Weight">
	<link rel="apple-touch-icon" href="icon.png">
   <title>Antomani Weight - Calcul Personnalis√©</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 5px;
            touch-action: manipulation;
        }

        .container {
            max-width: 100%;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 15px;
            text-align: center;
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .header h1 {
            font-size: 1.5rem;
            margin-bottom: 5px;
        }

        .nav-tabs {
            display: flex;
            background: #f8f9fa;
            border-bottom: 2px solid #e9ecef;
            position: sticky;
            top: 80px;
            z-index: 99;
        }

        .nav-tab {
            flex: 1;
            padding: 10px 4px;
            background: none;
            border: none;
            cursor: pointer;
            font-weight: 500;
            font-size: 0.7rem;
            transition: all 0.3s;
            border-bottom: 3px solid transparent;
            min-height: 44px;
            text-align: center;
        }

        .nav-tab.active {
            background: white;
            border-bottom-color: #667eea;
            color: #667eea;
        }

        .tab-content {
            display: none;
            padding: 15px;
            padding-bottom: 80px;
        }

        .tab-content.active {
            display: block;
        }

        /* Profile Setup */
        .profile-setup {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 15px;
        }

        .profile-complete {
            background: linear-gradient(135deg, #56ab2f 0%, #a8e6cf 100%);
        }

        .profile-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-bottom: 15px;
        }

        .profile-item {
            background: rgba(255,255,255,0.1);
            padding: 8px;
            border-radius: 8px;
            text-align: center;
            font-size: 0.8rem;
        }

        .profile-value {
            font-size: 1rem;
            font-weight: bold;
            margin-top: 3px;
        }

        .stats-card {
            background: #f8f9fa;
            padding: 12px;
            border-radius: 10px;
            margin: 8px 0;
            border-left: 4px solid #667eea;
        }

        .stats-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin: 5px 0;
        }

        .stats-label {
            font-size: 0.85rem;
            color: #636e72;
        }

        .stats-value {
            font-weight: 600;
            color: #2d3436;
        }

        /* Points Display */
        .points-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 15px;
            border-radius: 12px;
            margin-bottom: 15px;
        }

        .points-display {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
            flex-wrap: wrap;
            gap: 10px;
        }

        .points-main {
            font-size: 2rem;
            font-weight: bold;
        }

        .points-remaining {
            text-align: right;
        }

        .progress-bar {
            background: rgba(255,255,255,0.3);
            height: 8px;
            border-radius: 4px;
            overflow: hidden;
            margin: 10px 0;
        }

        .progress-fill {
            height: 100%;
            background: white;
            transition: width 0.5s ease;
        }

        /* Weekly Points Section */
        .weekly-points-section {
            background: linear-gradient(135deg, #f39c12 0%, #e67e22 100%);
            color: white;
            padding: 15px;
            border-radius: 12px;
            margin-bottom: 15px;
        }

        .weekly-points-display {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .weekly-points-main {
            font-size: 1.5rem;
            font-weight: bold;
        }

        .weekly-points-actions {
            display: flex;
            gap: 8px;
            margin-top: 10px;
            flex-wrap: wrap;
        }

        .weekly-points-actions .btn {
            flex: 1;
            min-width: 120px;
        }

        .weekly-reset-info {
            font-size: 0.8rem;
            text-align: center;
            margin-top: 8px;
            opacity: 0.9;
        }

        /* Form Styles */
        .form-section {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 12px;
            margin-bottom: 15px;
            border: 2px solid #e9ecef;
        }

        .section-title {
            font-size: 1.1rem;
            font-weight: 600;
            margin-bottom: 15px;
            color: #2d3436;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .form-group {
            margin-bottom: 15px;
        }

        .form-group label {
            display: block;
            font-weight: 500;
            margin-bottom: 6px;
            color: #2d3436;
            font-size: 0.9rem;
        }

        .form-control {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            font-size: 16px;
            -webkit-appearance: none;
        }

        .form-control:focus {
            outline: none;
            border-color: #667eea;
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
        }

        /* Buttons */
        .btn {
            padding: 8px 12px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.2s;
            font-size: 0.8rem;
            min-height: 36px;
            -webkit-appearance: none;
        }

        .btn:active {
            transform: scale(0.95);
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            width: 100%;
            padding: 12px;
            font-size: 1rem;
        }

        .btn-success {
            background: linear-gradient(135deg, #56ab2f 0%, #a8e6cf 100%);
            color: white;
        }

        .btn-warning {
            background: linear-gradient(135deg, #f39c12 0%, #e67e22 100%);
            color: white;
        }

        .btn-danger {
            background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%);
            color: white;
        }

        .btn-toggle {
            background: #e9ecef;
            color: #495057;
            margin: 5px;
            min-width: auto;
            padding: 8px 16px;
        }

        .btn-toggle.active {
            background: #667eea;
            color: white;
        }

        /* Search and Food */
        .search-section {
            margin-bottom: 15px;
        }

        .search-input {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #e9ecef;
            border-radius: 25px;
            font-size: 16px;
            -webkit-appearance: none;
        }

        .search-input:focus {
            outline: none;
            border-color: #667eea;
        }

        .food-grid {
            display: grid;
            gap: 8px;
            max-height: 60vh;
            overflow-y: auto;
            -webkit-overflow-scrolling: touch;
            margin-bottom: 15px;
        }

        .food-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px;
            background: #f8f9fa;
            border-radius: 12px;
            border: 2px solid #e9ecef;
            transition: all 0.2s;
            min-height: 60px;
        }

        .food-item:active {
            transform: scale(0.98);
            background: #e9ecef;
        }

        .food-icon {
            font-size: 1.5rem;
            min-width: 30px;
        }

        .food-info {
            flex: 1;
            min-width: 0;
        }

        .food-name {
            font-weight: 600;
            color: #2d3436;
            margin-bottom: 3px;
            font-size: 0.9rem;
            word-break: break-word;
        }

        .food-category {
            font-size: 0.75rem;
            color: #636e72;
            text-transform: capitalize;
        }

        .food-points {
            color: white;
            padding: 4px 8px;
            border-radius: 15px;
            font-weight: bold;
            font-size: 0.9em;
            background: #3498db;
        }

        .food-points.points-zero {
            background: #27ae60 !important;
        }

        .food-item .food-points.points-high {
            background: #e74c3c !important;
        }

        .btn-add {
            background: #667eea;
            color: white;
            min-width: 70px;
        }

        .btn-remove {
            background: #e53e3e;
            color: white;
            min-width: 30px;
            padding: 8px;
        }

        /* Category Filter */
        .category-filter {
            display: flex;
            gap: 5px;
            margin-bottom: 10px;
            overflow-x: auto;
            -webkit-overflow-scrolling: touch;
            padding: 5px 0;
        }

        .category-btn {
            padding: 6px 12px;
            background: #e9ecef;
            border: none;
            border-radius: 20px;
            font-size: 0.75rem;
            white-space: nowrap;
            cursor: pointer;
            transition: all 0.2s;
        }

        .category-btn.active {
            background: #667eea;
            color: white;
        }

        /* Consumed Foods */
        .consumed-section {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 12px;
            margin-top: 15px;
        }

        .consumed-item {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px;
            background: white;
            border-radius: 8px;
            margin-bottom: 8px;
            min-height: 50px;
        }

        /* Activity Section */
        .activity-form {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 12px;
            margin-bottom: 15px;
        }

        /* History Styles */
        .week-selector {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 12px;
            margin-bottom: 15px;
            text-align: center;
        }

        .week-nav {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .week-nav button {
            background: #667eea;
            color: white;
            border: none;
            padding: 8px 12px;
            border-radius: 8px;
            font-size: 0.9rem;
            cursor: pointer;
        }

        .current-week {
            font-weight: 600;
            font-size: 1rem;
        }

        .day-cards {
            display: grid;
            gap: 10px;
        }

        .day-card {
            background: white;
            border-radius: 12px;
            padding: 15px;
            border: 2px solid #e9ecef;
            cursor: pointer;
            transition: all 0.2s;
        }

        .day-card:hover {
            border-color: #667eea;
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.1);
        }

        .day-card.today {
            border-color: #56ab2f;
            background: linear-gradient(135deg, rgba(86, 171, 47, 0.1) 0%, rgba(168, 230, 207, 0.1) 100%);
        }

        .day-card.no-data {
            opacity: 0.6;
            background: #f8f9fa;
        }

        .day-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .day-name {
            font-weight: 600;
            font-size: 1.1rem;
            color: #2d3436;
        }

        .day-date {
            font-size: 0.85rem;
            color: #636e72;
        }

        .day-summary {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr 1fr;
            gap: 8px;
            text-align: center;
        }

        .summary-item {
            padding: 8px;
            border-radius: 8px;
            background: #f8f9fa;
        }

        .summary-value {
            font-weight: bold;
            font-size: 1rem;
            color: #667eea;
        }

        .summary-label {
            font-size: 0.7rem;
            color: #636e72;
            margin-top: 2px;
        }

        .day-details {
            margin-top: 15px;
            padding-top: 15px;
            border-top: 1px solid #e9ecef;
            display: none;
        }

        .day-details.expanded {
            display: block;
        }

        .detail-section {
            margin-bottom: 15px;
        }

        .detail-title {
            font-weight: 600;
            margin-bottom: 8px;
            font-size: 0.9rem;
            color: #2d3436;
        }

        .detail-list {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 8px;
        }

        .detail-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 4px 0;
            font-size: 0.8rem;
        }

        .detail-item:not(:last-child) {
            border-bottom: 1px solid #e9ecef;
        }

        /* Toast */
        .toast {
            position: fixed;
            bottom: 100px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0,0,0,0.8);
            color: white;
            padding: 10px 20px;
            border-radius: 25px;
            font-size: 0.9rem;
            z-index: 1001;
            opacity: 0;
            transition: opacity 0.3s;
            max-width: 90%;
            text-align: center;
            word-break: break-word;
        }

        .toast.show {
            opacity: 1;
        }

        .alert {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            color: #856404;
            padding: 10px 15px;
            border-radius: 8px;
            margin: 10px 0;
            font-size: 0.85rem;
        }

        .alert-success {
            background: #d4edda;
            border: 1px solid #c3e6cb;
            color: #155724;
        }

        .alert-danger {
            background: #f8d7da;
            border: 1px solid #f5c6cb;
            color: #721c24;
        }

        .alert-info {
            background: #d1ecf1;
            border: 1px solid #bee5eb;
            color: #0c5460;
        }

        .toggle-section {
            display: flex;
            justify-content: center;
            margin-bottom: 15px;
            background: #f8f9fa;
            border-radius: 25px;
            padding: 3px;
        }

        /* Data management buttons */
        .data-management {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 12px;
            margin-top: 15px;
        }

        .data-management h3 {
            font-size: 1rem;
            margin-bottom: 10px;
            color: #2d3436;
        }

        .data-actions {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
        }

        .data-actions .btn {
            flex: 1;
            min-width: 120px;
        }

        @media (max-width: 480px) {
            .nav-tab {
                font-size: 0.65rem;
                padding: 8px 2px;
            }
            
            .points-display {
                flex-direction: column;
                text-align: center;
                gap: 5px;
            }
            
            .points-main {
                font-size: 1.5rem;
            }
            
            .food-item {
                padding: 10px;
            }
            
            .form-row {
                grid-template-columns: 1fr;
            }
            
            .profile-grid {
                grid-template-columns: 1fr;
            }

            .day-summary {
                grid-template-columns: 1fr 1fr;
                gap: 5px;
            }

            .weekly-points-actions {
                flex-direction: column;
            }

            .data-actions {
                flex-direction: column;
            }
        }

        /* Prevent zoom on input focus */
        @media screen and (max-width: 480px) {
            input, select, textarea {
                font-size: 16px !important;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üèãÔ∏è‚Äç‚ôÄÔ∏è Antomani Weight</h1>
            <p>Calcul personnalis√© - Suivi intelligent</p>
        </div>

        <nav class="nav-tabs">
    <button class="nav-tab active" onclick="showTab('profile')">üë§ Profil</button>
    <button class="nav-tab" onclick="showTab('tracker')">üìä Suivi</button>
    <button class="nav-tab" onclick="showTab('activity')">üèÉ‚Äç‚ôÇÔ∏è Sport</button>
    <button class="nav-tab" onclick="showTab('integrations')">üîó Apps</button> <!-- ‚≠ê NOUVELLE LIGNE -->
    <button class="nav-tab" onclick="showTab('history')">üìÖ Historique</button>
</nav>

        <!-- Profile Tab -->
        <div id="profile" class="tab-content active">
            <div id="profileStatus" class="profile-setup">
                <div style="text-align: center; margin-bottom: 15px;">
                    <h3 id="profileTitle">üéØ Configuration de votre profil</h3>
                    <p id="profileSubtitle">Personnalisez vos points selon votre m√©tabolisme</p>
                </div>
                
                <div id="profileStats" style="display: none;">
                    <div class="profile-grid">
                        <div class="profile-item">
                            <div>IMC Actuel</div>
                            <div class="profile-value" id="currentBMI">--</div>
                        </div>
                        <div class="profile-item">
                            <div>IMC Objectif</div>
                            <div class="profile-value" id="targetBMI">--</div>
                        </div>
                        <div class="profile-item">
                            <div>M√©tabolisme</div>
                            <div class="profile-value" id="bmrDisplay">-- kcal</div>
                        </div>
                        <div class="profile-item">
                            <div>Points/Jour</div>
                            <div class="profile-value" id="calculatedPoints">--</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Mode Toggle -->
            <div class="toggle-section">
                <button class="btn btn-toggle active" id="autoMode" onclick="toggleCalculationMode('auto')">
                    ü§ñ Auto
                </button>
                <button class="btn btn-toggle" id="manualMode" onclick="toggleCalculationMode('manual')">
                    ‚úã Manuel
                </button>
            </div>

            <!-- Auto Mode Form -->
            <div id="autoModeForm">
                <div class="form-section">
                    <h3 class="section-title">üë§ Informations personnelles</h3>
                    
                    <div class="form-group">
                        <label for="userName">Nom complet</label>
                        <input type="text" id="userName" class="form-control" placeholder="Marie Dubois" oninput="calculatePoints()">
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="userAge">√Çge (ans)</label>
                            <input type="number" id="userAge" class="form-control" placeholder="28" min="15" max="100" oninput="calculatePoints()">
                        </div>
                        <div class="form-group">
                            <label for="userGender">Sexe</label>
                            <select id="userGender" class="form-control" onchange="calculatePoints()">
                                <option value="">Choisir...</option>
                                <option value="female">Femme</option>
                                <option value="male">Homme</option>
                            </select>
                        </div>
                    </div>
                </div>

                <div class="form-section">
                    <h3 class="section-title">üìè Mensurations</h3>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="userHeight">Taille (cm)</label>
                            <input type="number" id="userHeight" class="form-control" placeholder="165" min="140" max="220" oninput="calculatePoints()">
                        </div>
                        <div class="form-group">
                            <label for="currentWeight">Poids actuel (kg)</label>
                            <input type="number" id="currentWeight" class="form-control" placeholder="70" step="0.1" min="40" max="200" oninput="calculatePoints()">
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="targetWeight">Poids objectif (kg)</label>
                            <input type="number" id="targetWeight" class="form-control" placeholder="65" step="0.1" min="40" max="200" oninput="calculatePoints()">
                        </div>
                        <div class="form-group">
                            <label for="activityLevel">Niveau d'activit√©</label>
                            <select id="activityLevel" class="form-control" onchange="calculatePoints()">
                                <option value="">Choisir...</option>
                                <option value="1.2">S√©dentaire (bureau)</option>
                                <option value="1.375">Peu actif (1-3 fois/semaine)</option>
                                <option value="1.55">Mod√©r√©ment actif (3-5 fois/semaine)</option>
                                <option value="1.725">Tr√®s actif (6-7 fois/semaine)</option>
                                <option value="1.9">Extr√™mement actif (2x/jour)</option>
                            </select>
                        </div>
                    </div>
                </div>

                <div class="form-section">
                    <h3 class="section-title">üéØ Objectif de perte</h3>
                    
                    <div class="form-group">
                        <label for="weightLossGoal">Perte hebdomadaire souhait√©e</label>
                        <select id="weightLossGoal" class="form-control" onchange="calculatePoints()">
                            <option value="">Choisir...</option>
                            <option value="0.25">0.25 kg/semaine (lent)</option>
                            <option value="0.5">0.5 kg/semaine (mod√©r√©)</option>
                            <option value="0.75">0.75 kg/semaine (rapide)</option>
                            <option value="1">1 kg/semaine (tr√®s rapide)</option>
                        </select>
                    </div>
                </div>

                <!-- Calculation Results -->
                <div id="calculationResults" style="display: none;">
                    <div class="stats-card">
                        <div class="stats-row">
                            <span class="stats-label">M√©tabolisme de base (BMR)</span>
                            <span class="stats-value" id="bmrResult">-- kcal/jour</span>
                        </div>
                        <div class="stats-row">
                            <span class="stats-label">D√©pense √©nerg√©tique totale</span>
                            <span class="stats-value" id="tdeeResult">-- kcal/jour</span>
                        </div>
                        <div class="stats-row">
                            <span class="stats-label">D√©ficit calorique n√©cessaire</span>
                            <span class="stats-value" id="deficitResult">-- kcal/jour</span>
                        </div>
                        <div class="stats-row">
                            <span class="stats-label">Calories cibles par jour</span>
                            <span class="stats-value" id="targetCaloriesResult">-- kcal/jour</span>
                        </div>
                    </div>
                    
                    <div class="alert alert-success" id="pointsCalculation">
                        <strong>üéØ Points calcul√©s : <span id="finalPoints">--</span> points/jour</strong>
                        <div style="margin-top: 8px; font-size: 0.8rem;" id="calculationExplanation"></div>
                    </div>

                    <div class="alert alert-info" id="genderRangeInfo" style="display: none;">
                        <div id="genderRangeText"></div>
                    </div>
                </div>
            </div>

            <!-- Manual Mode Form -->
            <div id="manualModeForm" style="display: none;">
                <div class="form-section">
                    <h3 class="section-title">‚úã Configuration manuelle</h3>
                    
                    <div class="form-group">
                        <label for="manualPoints">Points quotidiens souhait√©s</label>
                        <input type="number" id="manualPoints" class="form-control" placeholder="25" min="20" max="50" oninput="updateManualPoints()">
                        <small style="color: #636e72; font-size: 0.8rem;">
                            Recommand√© : 23-30 points pour les femmes, 30-40 pour les hommes
                        </small>
                    </div>
                </div>
            </div>

            <button class="btn btn-primary" onclick="saveProfile()">
                üíæ Sauvegarder le profil
            </button>

            <!-- Data Management Section -->
            <div class="data-management">
                <h3>üìä Gestion des donn√©es</h3>
                <div class="data-actions">
                    <button class="btn btn-success" onclick="exportData()">üì§ Exporter</button>
                    <button class="btn btn-warning" onclick="importData()">üì• Importer</button>
                    <button class="btn btn-danger" onclick="resetAllData()">üóëÔ∏è Reset</button>
                </div>
            </div>
        </div>

        <!-- Tracker Tab -->
        <div id="tracker" class="tab-content">
            <!-- Points Header -->
            <div class="points-header">
                <div class="points-display">
                    <div>
                        <div class="points-main" id="dailyPointsDisplay">0 / 25</div>
                        <div>Points utilis√©s</div>
                    </div>
                    <div class="points-remaining">
                        <div style="font-size: 1.2rem; font-weight: bold;" id="remainingPointsDisplay">25</div>
                        <div>Points restants</div>
                    </div>
                </div>
                <div class="progress-bar">
                    <div class="progress-fill" id="progressBar" style="width: 0%"></div>
                </div>
                <div style="margin-top: 8px; font-size: 0.8rem; text-align: center;">
                    <span>Base: <span id="basePointsDisplay">25</span> pts</span> |
                    <span>Sport: +<span id="activityPointsDisplay">0</span> pts</span> |
                    <span>√âcarts: +<span id="cheatPointsDisplay">0</span> pts</span>
                </div>
            </div>

            <!-- Weekly Points Section -->
            <div class="weekly-points-section">
                <div class="weekly-points-display">
                    <div>
                        <div class="weekly-points-main" id="weeklyPointsDisplay">0</div>
                        <div>Points √©carts disponibles</div>
                    </div>
                </div>
                <div class="weekly-points-actions">
                    <button class="btn btn-warning" onclick="useWeeklyPoints()">
                        üçï Utiliser √©carts
                    </button>
                    <button class="btn btn-success" onclick="saveRemainingPoints()">
                        üí∞ √âconomiser restants
                    </button>
                </div>
                <div class="weekly-reset-info">
                    Remise √† z√©ro tous les lundis ‚Ä¢ Prochain reset: <span id="nextResetDate">--</span>
                </div>
            </div>

            <!-- Search Section -->
            <div class="search-section">
    <input type="text" id="foodSearch" class="search-input" placeholder="üîç Rechercher..." oninput="filterFoods()">
</div>

<!-- Add Custom Food Button -->
<div style="margin-bottom: 15px;">
    <button class="btn btn-primary" onclick="showCustomFoodModal()" style="width: 100%;">
        ‚ûï Ajouter un aliment personnalis√©
    </button>
</div>

<div style="margin-bottom: 15px;">
    <button class="btn btn-primary" onclick="showPhotoScanModal()" style="width: 100%;">
        üì∏ Scanner un aliment avec l'IA
    </button>
</div>

            <!-- Category Filter -->
            <div class="category-filter">
                <button class="category-btn active" onclick="filterByCategory('all')">Tout</button>
                <button class="category-btn" onclick="filterByCategory('fruits')">üçé Fruits</button>
                <button class="category-btn" onclick="filterByCategory('legumes')">ü•ó L√©gumes</button>
                <button class="category-btn" onclick="filterByCategory('proteines')">ü•© Prot√©ines</button>
                <button class="category-btn" onclick="filterByCategory('laitier')">ü•õ Laitier</button>
                <button class="category-btn" onclick="filterByCategory('cereales')">üåæ C√©r√©ales</button>
                <button class="category-btn" onclick="filterByCategory('charcuterie')">ü•ì Charcuterie</button>
                <button class="category-btn" onclick="filterByCategory('fast_food')">üçî Fast Food</button>
                <button class="category-btn" onclick="filterByCategory('street_food')">ü•ô Street Food</button>
                <button class="category-btn" onclick="filterByCategory('plats_cuisines')">üç≤ Plats</button>
                <button class="category-btn" onclick="filterByCategory('desserts')">üç® Desserts</button>
                <button class="category-btn" onclick="filterByCategory('supplements')">üí™ Suppl√©ments</button>
                <button class="category-btn" onclick="filterByCategory('sauces')">ü•Ñ Sauces</button>
                <button class="category-btn" onclick="filterByCategory('plaisir')">üç´ Plaisir</button>
                <button class="category-btn" onclick="filterByCategory('boissons')">ü•§ Boissons</button>
            </div>

            <!-- Food Grid -->
            <div class="food-grid" id="foodGrid"></div>

            <!-- Consumed Foods -->
            <div class="consumed-section" id="consumedSection" style="display: none;">
                <h3>üçΩÔ∏è Consomm√© aujourd'hui</h3>
                <div id="consumedFoods"></div>
                <div style="text-align: center; margin-top: 12px; padding: 8px; background: white; border-radius: 8px;">
                    <strong>Total: <span id="totalPointsConsumed">0</span> points</strong>
                </div>
            </div>
        </div>

        <!-- Activity Tab -->
        <div id="activity" class="tab-content">
            <!-- Cumulative Calories Section -->
            <div class="activity-form">
                <h3>üî• Calories cumulatives</h3>
                
                <div class="form-group">
                    <label for="caloriesInput">Calories br√ªl√©es</label>
                    <input type="number" id="caloriesInput" class="form-control" placeholder="250" oninput="updateCaloriesPoints()">
                    <small style="color: #636e72; font-size: 0.8rem;">
                        Total accumul√©: <span id="totalCaloriesDisplay">0</span> calories
                        (Points: <span id="totalCaloriesPoints">0</span>)
                    </small>
                </div>
                
                <button class="btn btn-primary" onclick="addCaloriesActivity()">
                    Ajouter calories (+<span id="caloriesPoints">0</span> pts)
                </button>
            </div>

            <!-- Cumulative Steps Section -->
            <div class="activity-form">
                <h3>üö∂‚Äç‚ôÇÔ∏è Pas cumulatifs</h3>
                
                <div class="form-group">
                    <label for="stepsInput">Nombre de pas</label>
                    <input type="number" id="stepsInput" class="form-control" placeholder="10000" oninput="updateStepsPoints()">
                    <small style="color: #636e72; font-size: 0.8rem;">
                        Total accumul√©: <span id="totalStepsDisplay">0</span> pas
                        (Points: <span id="totalStepsPoints">0</span>)
                    </small>
                </div>
                
                <button class="btn btn-primary" onclick="addStepsActivity()">
                    Ajouter pas (+<span id="stepsPoints">0</span> pts)
                </button>
            </div>

            <!-- Activities List -->
            <div id="activitiesSection" style="display: none;">
                <h3>‚úÖ Activit√©s d'aujourd'hui</h3>
                <div id="activitiesList"></div>
                
                <div style="text-align: center; margin-top: 15px; padding: 12px; background: linear-gradient(135deg, #56ab2f 0%, #a8e6cf 100%); color: white; border-radius: 10px;">
                    <div style="font-size: 1.5rem; font-weight: bold;">+<span id="totalActivityPoints">0</span></div>
                    <div>Points gagn√©s</div>
                </div>
            </div>
        </div>

<!-- Integrations Tab -->
        <div id="integrations" class="tab-content">
            <!-- Section IA Photo Scan -->
            <div class="form-section">
                <h3 class="section-title">üì∏ Scan d'aliments par IA</h3>
                
                <button class="btn btn-primary" onclick="showPhotoScanModal()" style="margin-bottom: 10px;">
                    üì∑ Scanner un aliment
                </button>
                
                <div class="alert alert-info" style="font-size: 0.85rem;">
                    <strong>üí° Comment √ßa marche :</strong><br>
                    1. Prenez une photo de votre aliment<br>
                    2. L'IA analyse et identifie l'aliment<br>
                    3. Les points sont calcul√©s automatiquement<br>
                    4. Ajoutez-le √† votre suivi en un clic
                </div>
                
                <button class="btn btn-warning" onclick="showApiKeyModal()">
                    üîë Configurer cl√© API
                </button>
                
                <div id="apiKeyStatus" style="margin-top: 10px; font-size: 0.85rem; color: #636e72; text-align: center;">
                    <!-- Status affich√© dynamiquement -->
                </div>
            </div>

            <!-- Section Apps Sant√© -->
            <div class="form-section">
                <h3 class="section-title">üí™ Applications Sant√©</h3>
                
                <div class="health-apps-grid" id="healthAppsGrid">
                    <!-- G√©n√©r√© dynamiquement par JavaScript -->
                </div>
                
                <div style="display: flex; gap: 8px; margin-top: 15px;">
                    <button class="btn btn-primary" onclick="syncAllHealthApps()" style="flex: 1;">
                        üîÑ Synchroniser
                    </button>
                    <button class="btn btn-success" onclick="toggleAutoSync()" style="flex: 1;">
                        ‚öôÔ∏è Auto-sync
                    </button>
                </div>
                
                <div id="syncStatusMessage" style="display: none; margin-top: 10px; padding: 10px; border-radius: 8px; font-size: 0.85rem; text-align: center;">
                    <!-- Messages de sync -->
                </div>
                
                <div class="alert alert-info" style="font-size: 0.85rem; margin-top: 15px;">
                    <strong>‚ÑπÔ∏è Apps support√©es :</strong><br>
                    ‚Ä¢ Google Fit (Android)<br>
                    ‚Ä¢ Apple Health (iOS - app native requise)<br>
                    ‚Ä¢ Garmin Connect<br>
                    ‚Ä¢ Fitbit<br>
                    ‚Ä¢ Strava<br>
                    ‚Ä¢ Samsung Health (app native requise)<br>
                    ‚Ä¢ Xiaomi Mi Fit (import manuel)
                </div>
            </div>

            <!-- Section Apps Connect√©es -->
            <div class="form-section" id="connectedAppsSection" style="display: none;">
                <h3 class="section-title">‚úÖ Applications connect√©es</h3>
                <div id="connectedAppsList">
                    <!-- Liste g√©n√©r√©e dynamiquement -->
                </div>
            </div>

            <!-- Param√®tres de synchronisation -->
            <div class="form-section">
                <h3 class="section-title">‚öôÔ∏è Param√®tres de synchronisation</h3>
                
                <div class="stats-card">
                    <div class="stats-row">
                        <span class="stats-label">Synchronisation automatique</span>
                        <label class="toggle-switch">
                            <input type="checkbox" id="autoSyncToggle" onchange="handleAutoSyncToggle(this.checked)">
                            <span class="slider"></span>
                        </label>
                    </div>
                    <div class="stats-row">
                        <span class="stats-label">Fr√©quence (minutes)</span>
                        <select id="syncFrequency" class="form-control" style="width: auto; padding: 8px;" onchange="updateSyncFrequency()">
                            <option value="30">30 min</option>
                            <option value="60" selected>1 heure</option>
                            <option value="120">2 heures</option>
                            <option value="180">3 heures</option>
                        </select>
                    </div>
                </div>
                
                <div class="alert alert-info" style="font-size: 0.8rem; margin-top: 10px;">
                    üí° La synchronisation automatique r√©cup√®re vos donn√©es de sport en arri√®re-plan
                </div>
            </div>
        </div>

        <!-- History Tab -->
        <div id="history" class="tab-content">
            <div class="week-selector">
                <div class="week-nav">
                    <button onclick="changeWeek(-1)">‚Üê Semaine pr√©c√©dente</button>
                    <div class="current-week" id="currentWeekDisplay">Semaine du ...</div>
                    <button onclick="changeWeek(1)">Semaine suivante ‚Üí</button>
                </div>
            </div>

            <div class="day-cards" id="dayCards">
                <!-- Les cartes des jours seront g√©n√©r√©es dynamiquement -->
            </div>
        </div>
    </div>

    <!-- Toast for notifications -->
    <div id="toast" class="toast"></div>

    <script>
        // Global variables
        let userData = {};
        let consumedFoods = [];
        let activities = [];
        let currentCategory = 'all';
        
        // Variables pour le cumul des activit√©s
        let totalCalories = 0;
        let totalSteps = 0;

        // Variables pour l'historique
        let currentWeekOffset = 0;
        let historyData = {};

        // Variables pour les points √©carts hebdomadaires
        let weeklyExtraPoints = 0;
        let currentWeekKey = '';
        let usedWeeklyPoints = 0;

        // LocalStorage keys
        const STORAGE_KEY = 'antomaniWeightData';
        const BACKUP_KEY = 'antomaniWeightBackup';

        // Food database with comprehensive French foods
        const foodDatabase = [
            // Fruits
            { name: "Pomme (1 moyenne)", category: "fruits", icon: "üçé", points: 0 },
            { name: "Banane (1 moyenne)", category: "fruits", icon: "üçå", points: 0 },
            { name: "Orange (1 moyenne)", category: "fruits", icon: "üçä", points: 0 },
            { name: "Poire (1 moyenne)", category: "fruits", icon: "üçê", points: 0 },
            { name: "Fraises (100g)", category: "fruits", icon: "üçì", points: 0 },
            { name: "Fraises (200g)", category: "fruits", icon: "üçì", points: 1 },
            { name: "Raisins (100g)", category: "fruits", icon: "üçá", points: 0 },
            { name: "Raisins (200g)", category: "fruits", icon: "üçá", points: 1 },
            { name: "Kiwi (1 moyen)", category: "fruits", icon: "ü•ù", points: 0 },
            { name: "Ananas (1 tranche)", category: "fruits", icon: "üçç", points: 0 },
            { name: "Mangue (1/2)", category: "fruits", icon: "ü•≠", points: 0 },
            { name: "P√™che (1 moyenne)", category: "fruits", icon: "üçë", points: 0 },
            { name: "Abricot (3 unit√©s)", category: "fruits", icon: "üçë", points: 1 },
            { name: "Melon (200g)", category: "fruits", icon: "üçà", points: 1 },
            { name: "Past√®que (200g)", category: "fruits", icon: "üçâ", points: 1 },
            { name: "Cerises (125g)", category: "fruits", icon: "üçí", points: 2 },
            { name: "Prunes (3 unit√©s)", category: "fruits", icon: "üçá", points: 2 },
            { name: "Myrtilles (125g)", category: "fruits", icon: "ü´ê", points: 2 },
            { name: "Avocat (1/4)", category: "fruits", icon: "ü•ë", points: 2 },
            { name: "Avocat (1/2)", category: "fruits", icon: "ü•ë", points: 3 },
            { name: "Avocat (1 entier)", category: "fruits", icon: "ü•ë", points: 6 },
            { name: "Noix de coco (30g)", category: "fruits", icon: "ü••", points: 4 },
            { name: "Framboises (125g)", category: "fruits", icon: "üçì", points: 1 },
            { name: "Citron (1 unit√©)", category: "fruits", icon: "üçã", points: 0 },
            { name: "Pamplemousse (1/2 unit√©)", category: "fruits", icon: "üçä", points: 1 },
            { name: "Figues fra√Æches (3 unit√©s)", category: "fruits", icon: "üçá", points: 2 },
            { name: "Figues s√®ches (3 unit√©s)", category: "fruits", icon: "üçá", points: 4 },
            { name: "Dattes fra√Æches (3 unit√©s)", category: "fruits", icon: "üçØ", points: 3 },
            { name: "Dattes Medjool (2 unit√©s)", category: "fruits", icon: "üçØ", points: 4 },
            { name: "Raisins secs (30g)", category: "fruits", icon: "üçá", points: 3 },
            { name: "Cranberries s√©ch√©es (30g)", category: "fruits", icon: "üçí", points: 3 },
            { name: "Pruneaux (4 unit√©s)", category: "fruits", icon: "üçá", points: 3 },
            { name: "Abricots secs (6 unit√©s)", category: "fruits", icon: "üçë", points: 3 },
            
            // L√©gumes
            { name: "Brocolis (250g)", category: "legumes", icon: "ü•¶", points: 0 },
            { name: "√âpinards (250g)", category: "legumes", icon: "ü•¨", points: 0 },
            { name: "Haricots verts (250g)", category: "legumes", icon: "ü´ò", points: 0 },
            { name: "Courgettes (250g)", category: "legumes", icon: "ü•í", points: 0 },
            { name: "Tomates (100g)", category: "legumes", icon: "üçÖ", points: 0 },
            { name: "Tomates (250g)", category: "legumes", icon: "üçÖ", points: 1 },
            { name: "Carottes (100g)", category: "legumes", icon: "ü•ï", points: 0 },
            { name: "Carottes (250g)", category: "legumes", icon: "ü•ï", points: 1 },
            { name: "Salade verte (250g)", category: "legumes", icon: "ü•ó", points: 0 },
            { name: "Concombre (250g)", category: "legumes", icon: "ü•í", points: 0 },
            { name: "Poivrons (250g)", category: "legumes", icon: "ü´ë", points: 1 },
            { name: "Aubergines (250g)", category: "legumes", icon: "üçÜ", points: 1 },
            { name: "Champignons (250g)", category: "legumes", icon: "üçÑ", points: 0 },
            { name: "Radis (250g)", category: "legumes", icon: "ü•ï", points: 0 },
            { name: "Betteraves (200g)", category: "legumes", icon: "ü•ï", points: 2 },
            { name: "Chou-fleur (250g)", category: "legumes", icon: "ü•¶", points: 0 },
            { name: "Choux de Bruxelles (250g)", category: "legumes", icon: "ü•¨", points: 1 },
            { name: "Endives (250g)", category: "legumes", icon: "ü•¨", points: 0 },
            { name: "M√¢che (250g)", category: "legumes", icon: "ü•¨", points: 0 },
            { name: "Roquette (250g)", category: "legumes", icon: "ü•¨", points: 0 },
            { name: "Petits pois (125g)", category: "legumes", icon: "üü¢", points: 2 },
            { name: "Artichaut (1 unit√©)", category: "legumes", icon: "ü•¨", points: 1 },
            { name: "Asperges (200g)", category: "legumes", icon: "ü•¨", points: 1 },
            { name: "C√©leri branche (200g)", category: "legumes", icon: "ü•¨", points: 0 },
            { name: "C√©leri-rave (200g)", category: "legumes", icon: "ü•¨", points: 1 },
            { name: "Navets (200g)", category: "legumes", icon: "ü•ï", points: 1 },
            { name: "Panais (200g)", category: "legumes", icon: "ü•ï", points: 2 },
            { name: "Poireaux (200g)", category: "legumes", icon: "ü•¨", points: 1 },
            { name: "Potiron (200g)", category: "legumes", icon: "üéÉ", points: 1 },
            { name: "Butternut (200g)", category: "legumes", icon: "üéÉ", points: 2 },
            { name: "Courge spaghetti (200g)", category: "legumes", icon: "üéÉ", points: 1 },
            { name: "Choucroute (150g)", category: "legumes", icon: "ü•¨", points: 1 },
            { name: "Soupe de l√©gumes maison (250ml)", category: "legumes", icon: "ü•Ñ", points: 1 },
            { name: "Velout√© de ch√¢taignes (250ml)", category: "legumes", icon: "üå∞", points: 3 },
            { name: "Soupe au pistou (250ml)", category: "legumes", icon: "üåø", points: 4 },
            { name: "Potage parmentier (250ml)", category: "legumes", icon: "ü•î", points: 2 },
            { name: "Vichyssoise (250ml)", category: "legumes", icon: "ü•î", points: 4 },
            { name: "Soupe √† l'oignon (250ml)", category: "legumes", icon: "üç≤", points: 3 },
            { name: "Gaspacho (250ml)", category: "legumes", icon: "üçÖ", points: 2 },
            { name: "Velout√© de champignons (250ml)", category: "legumes", icon: "üçÑ", points: 3 },
            { name: "Soupe de potiron (250ml)", category: "legumes", icon: "üéÉ", points: 2 },
            { name: "Minestrone (250ml)", category: "legumes", icon: "üç≤", points: 4 },

            // Prot√©ines
            { name: "Blanc de poulet (50g)", category: "proteines", icon: "üçó", points: 2 },
            { name: "Blanc de poulet (100g)", category: "proteines", icon: "üêó", points: 4 },
            { name: "Blanc de poulet (150g)", category: "proteines", icon: "üçó", points: 6 },
            { name: "Cuisse de poulet (100g)", category: "proteines", icon: "üçó", points: 6 },
            { name: "Dinde (100g)", category: "proteines", icon: "ü¶É", points: 4 },
            { name: "Poisson blanc (100g)", category: "proteines", icon: "üêü", points: 3 },
            { name: "Saumon (50g)", category: "proteines", icon: "üêü", points: 3 },
            { name: "Saumon (100g)", category: "proteines", icon: "üç£", points: 5 },
            { name: "Saumon (150g)", category: "proteines", icon: "üêü", points: 8 },
            { name: "Thon au naturel (50g)", category: "proteines", icon: "üêü", points: 2 },
            { name: "Thon au naturel (100g)", category: "proteines", icon: "üêü", points: 3 },
            { name: "Sardines (100g)", category: "proteines", icon: "üêü", points: 4 },
            { name: "Maquereau (100g)", category: "proteines", icon: "üêü", points: 5 },
            { name: "Cabillaud (100g)", category: "proteines", icon: "üêü", points: 3 },
            { name: "Sole (100g)", category: "proteines", icon: "üêü", points: 3 },
            { name: "B≈ìuf maigre (50g)", category: "proteines", icon: "ü•©", points: 3 },
            { name: "B≈ìuf maigre (100g)", category: "proteines", icon: "ü•©", points: 6 },
            { name: "B≈ìuf maigre (150g)", category: "proteines", icon: "ü•©", points: 9 },
            { name: "C√¥te de b≈ìuf maigre (150g)", category: "proteines", icon: "ü•©", points: 14 },
            { name: "B≈ìuf hach√© 5% (100g)", category: "proteines", icon: "ü•©", points: 5 },
            { name: "B≈ìuf hach√© 15% (100g)", category: "proteines", icon: "ü•©", points: 7 },
            { name: "Porc filet (100g)", category: "proteines", icon: "ü•©", points: 5 },
            { name: "C√¥te de porc (100g)", category: "proteines", icon: "ü•©", points: 8 },
            { name: "Agneau (100g)", category: "proteines", icon: "ü•©", points: 8 },
            { name: "Veau (100g)", category: "proteines", icon: "ü•©", points: 6 },
            { name: "≈íuf entier (1 unit√©)", category: "proteines", icon: "ü•ö", points: 0 },
            { name: "≈íufs entiers (2 unit√©s)", category: "proteines", icon: "ü•ö", points: 0 },
            { name: "≈íufs entiers (3 unit√©s)", category: "proteines", icon: "ü•ö", points: 1 },
            { name: "Blancs d'≈ìufs (3 unit√©s)", category: "proteines", icon: "ü•ö", points: 0 },
            { name: "Jaunes d'≈ìufs (3 unit√©s)", category: "proteines", icon: "ü•ö", points: 2 },
            { name: "Crevettes (50g)", category: "proteines", icon: "ü¶ê", points: 1 },
            { name: "Crevettes (100g)", category: "proteines", icon: "ü¶ê", points: 2 },
            { name: "Crevettes (150g)", category: "proteines", icon: "ü¶ê", points: 3 },
            { name: "Moules (100g)", category: "proteines", icon: "ü¶™", points: 2 },
            { name: "Saint-Jacques (100g)", category: "proteines", icon: "ü¶™", points: 3 },
            { name: "Crabe (100g)", category: "proteines", icon: "ü¶Ä", points: 2 },
            { name: "Homard (100g)", category: "proteines", icon: "ü¶û", points: 3 },
            { name: "G√©siers de canard (100g)", category: "proteines", icon: "ü¶Ü", points: 4 },
            { name: "Foie de volaille (100g)", category: "proteines", icon: "üêî", points: 5 },
            { name: "Rognons (100g)", category: "proteines", icon: "ü•©", points: 4 },
            { name: "Langue de b≈ìuf (100g)", category: "proteines", icon: "ü•©", points: 7 },
            { name: "Lapin (100g)", category: "proteines", icon: "üê∞", points: 5 },
            { name: "Pigeon (100g)", category: "proteines", icon: "üïäÔ∏è", points: 6 },
            { name: "Caille (1 unit√©)", category: "proteines", icon: "üê¶", points: 8 },
            { name: "Escargots (12 unit√©s)", category: "proteines", icon: "üêå", points: 3 },
            { name: "Cuisses de grenouille (6 unit√©s)", category: "proteines", icon: "üê∏", points: 2 },
            { name: "Truite (100g)", category: "proteines", icon: "üêü", points: 4 },
            { name: "Bar (100g)", category: "proteines", icon: "üêü", points: 3 },
            { name: "Dorade (100g)", category: "proteines", icon: "üêü", points: 3 },
            { name: "Turbot (100g)", category: "proteines", icon: "üêü", points: 3 },
            { name: "Lotte (100g)", category: "proteines", icon: "üêü", points: 3 },
            { name: "Rouget (100g)", category: "proteines", icon: "üêü", points: 4 },
            { name: "Anchois (50g)", category: "proteines", icon: "üêü", points: 3 },
            { name: "Hareng (100g)", category: "proteines", icon: "üêü", points: 6 },
            { name: "G√©siers confits (100g)", category: "proteines", icon: "ü¶Ü", points: 5 },
            { name: "Consomm√© de volaille (250ml)", category: "proteines", icon: "üêî", points: 1 },
            { name: "Bouillabaisse marseillaise (350ml)", category: "proteines", icon: "üêü", points: 12 },

            // Produits laitiers et fromages
            { name: "Lait √©cr√©m√© (250ml)", category: "laitier", icon: "ü•õ", points: 2 },
            { name: "Lait demi-√©cr√©m√© (250ml)", category: "laitier", icon: "ü•õ", points: 3 },
            { name: "Lait entier (250ml)", category: "laitier", icon: "ü•õ", points: 4 },
            { name: "Yaourt nature 0% (125g)", category: "laitier", icon: "ü•õ", points: 0 },
            { name: "Yaourt nature (125g)", category: "laitier", icon: "ü•õ", points: 3 },
            { name: "Fromage blanc 0% (125g)", category: "laitier", icon: "ü•õ", points: 0 },
            { name: "Fromage blanc 20% (125g)", category: "laitier", icon: "ü•õ", points: 3 },
            { name: "Fromage blanc 0% fruits (125g)", category: "desserts", icon: "ü•õ", points: 2 },
            { name: "Compote sans sucre ajout√©", category: "desserts", icon: "üçé", points: 1 },
            { name: "Chia pudding (125g)", category: "desserts", icon: "ü•Ñ", points: 4 },
            { name: "Tapioca au lait de coco", category: "desserts", icon: "ü••", points: 5 },
            { name: "Riz au lait (125g)", category: "desserts", icon: "üçö", points: 5 },
            { name: "Semoule au lait (125g)", category: "desserts", icon: "ü•õ", points: 5 },
            { name: "Yaourt grec 0% (125g)", category: "laitier", icon: "ü•õ", points: 2 },
            { name: "Yaourt grec (125g)", category: "laitier", icon: "ü•õ", points: 4 },
            { name: "Petits-suisses (2 unit√©s)", category: "laitier", icon: "ü•õ", points: 3 },
            { name: "Emmental (15g)", category: "laitier", icon: "üßÄ", points: 2 },
            { name: "Emmental (30g)", category: "laitier", icon: "üßÄ", points: 4 },
            { name: "Emmental (50g)", category: "laitier", icon: "üßÄ", points: 5 },
            { name: "Gruy√®re (15g)", category: "laitier", icon: "üßÄ", points: 2 },
            { name: "Gruy√®re (30g)", category: "laitier", icon: "üßÄ", points: 3 },
            { name: "Camembert (15g)", category: "laitier", icon: "üßÄ", points: 2 },
            { name: "Camembert (30g)", category: "laitier", icon: "üßÄ", points: 3 },
            { name: "Camembert (60g)", category: "laitier", icon: "üßÄ", points: 6 },
            { name: "Brie (30g)", category: "laitier", icon: "üßÄ", points: 3 },
            { name: "Roquefort (30g)", category: "laitier", icon: "üßÄ", points: 4 },
            { name: "Ch√®vre frais (15g)", category: "laitier", icon: "üßÄ", points: 1 },
            { name: "Ch√®vre frais (30g)", category: "laitier", icon: "üßÄ", points: 2 },
            { name: "Ch√®vre frais (60g)", category: "laitier", icon: "üßÄ", points: 4 },
            { name: "Ch√®vre sec (30g)", category: "laitier", icon: "üßÄ", points: 4 },
            { name: "Cheddar (30g)", category: "laitier", icon: "üßÄ", points: 4 },
            { name: "Mozzarella (30g)", category: "laitier", icon: "üßÄ", points: 2 },
            { name: "Mozzarella (60g)", category: "laitier", icon: "üßÄ", points: 4 },
            { name: "Feta (30g)", category: "laitier", icon: "üßÄ", points: 2 },
            { name: "Feta (60g)", category: "laitier", icon: "üßÄ", points: 4 },
            { name: "Parmesan (10g)", category: "laitier", icon: "üßÄ", points: 1 },
            { name: "Parmesan (20g)", category: "laitier", icon: "üßÄ", points: 3 },
            { name: "Parmesan (40g)", category: "laitier", icon: "üßÄ", points: 5 },
            { name: "Raclette (50g)", category: "laitier", icon: "üßÄ", points: 6 },
            { name: "Comt√© (30g)", category: "laitier", icon: "üßÄ", points: 3 },
            { name: "Reblochon (30g)", category: "laitier", icon: "üßÄ", points: 3 },
            { name: "Bleu d'Auvergne (30g)", category: "laitier", icon: "üßÄ", points: 3 },
            { name: "Boursin (30g)", category: "laitier", icon: "üßÄ", points: 4 },
            { name: "Mascarpone (30g)", category: "laitier", icon: "üßÄ", points: 5 },
            { name: "Ricotta (50g)", category: "laitier", icon: "üßÄ", points: 2 },
            { name: "Cottage cheese (100g)", category: "laitier", icon: "üßÄ", points: 2 },
            { name: "Philadelphia (30g)", category: "laitier", icon: "üßÄ", points: 4 },
            { name: "Cr√®me fra√Æche √©paisse (30ml)", category: "laitier", icon: "ü•õ", points: 3 },
            { name: "Cr√®me fra√Æche liquide (30ml)", category: "laitier", icon: "ü•õ", points: 2 },
            { name: "Cr√®me all√©g√©e (30ml)", category: "laitier", icon: "ü•õ", points: 1 },
            { name: "Beurre doux (10g)", category: "laitier", icon: "üßà", points: 2 },
            { name: "Beurre sal√© (10g)", category: "laitier", icon: "üßà", points: 2 },
            { name: "Beurre all√©g√© (10g)", category: "laitier", icon: "üßà", points: 1 },

            // C√©r√©ales et f√©culents
            { name: "Riz blanc cuit (50g)", category: "cereales", icon: "üçö", points: 1 },
            { name: "Riz blanc cuit (75g)", category: "cereales", icon: "üçö", points: 2 },
            { name: "Riz blanc cuit (125g)", category: "cereales", icon: "üçö", points: 4 },
            { name: "Riz blanc cuit (200g)", category: "cereales", icon: "üçö", points: 5 },
            { name: "Riz complet cuit (50g)", category: "cereales", icon: "üçö", points: 1 },
            { name: "Riz complet cuit (125g)", category: "cereales", icon: "üçö", points: 3 },
            { name: "Riz complet cuit (200g)", category: "cereales", icon: "üçö", points: 5 },
            { name: "Riz basmati cuit (125g)", category: "cereales", icon: "üçö", points: 3 },
            { name: "P√¢tes blanches cuites (50g)", category: "cereales", icon: "üçù", points: 1 },
            { name: "P√¢tes blanches cuites (75g)", category: "cereales", icon: "üçù", points: 2 },
            { name: "P√¢tes blanches cuites (125g)", category: "cereales", icon: "üçù", points: 4 },
            { name: "P√¢tes blanches cuites (200g)", category: "cereales", icon: "üçù", points: 5 },
            { name: "P√¢tes compl√®tes cuites (125g)", category: "cereales", icon: "üçù", points: 3 },
            { name: "Pommes de terre vapeur (100g)", category: "cereales", icon: "ü•î", points: 2 },
            { name: "Pommes de terre vapeur (200g)", category: "cereales", icon: "ü•î", points: 3 },
            { name: "Pommes de terre vapeur (300g)", category: "cereales", icon: "ü•î", points: 5 },
            { name: "Pur√©e de pommes de terre (125g)", category: "cereales", icon: "ü•î", points: 4 },
            { name: "Frites (100g)", category: "cereales", icon: "üçü", points: 7 },
            { name: "Pain blanc (30g)", category: "cereales", icon: "üçû", points: 2 },
            { name: "Pain complet (30g)", category: "cereales", icon: "üçû", points: 2 },
            { name: "Pain de mie (2 tranches)", category: "cereales", icon: "üçû", points: 3 },
            { name: "Baguette (60g)", category: "cereales", icon: "ü•ñ", points: 5 },
            { name: "Biscottes (3 unit√©s)", category: "cereales", icon: "üçû", points: 3 },
            { name: "C√©r√©ales nature (30g)", category: "cereales", icon: "ü•£", points: 3 },
            { name: "Quinoa cuit (50g)", category: "cereales", icon: "üåæ", points: 2 },
            { name: "Quinoa cuit (125g)", category: "cereales", icon: "üåæ", points: 5 },
            { name: "Quinoa cuit (200g)", category: "cereales", icon: "üåæ", points: 6 },
            { name: "Boulgour cuit (75g)", category: "cereales", icon: "üåæ", points: 2 },
            { name: "Boulgour cuit (125g)", category: "cereales", icon: "üåæ", points: 3 },
            { name: "Avoine (30g sec)", category: "cereales", icon: "üåæ", points: 3 },
            { name: "Muesli (30g)", category: "cereales", icon: "ü•£", points: 4 },
            { name: "Lentilles cuites (125g)", category: "cereales", icon: "ü´ò", points: 3 },
            { name: "Haricots blancs cuits (125g)", category: "cereales", icon: "ü´ò", points: 3 },
            { name: "Pois chiches cuits (125g)", category: "cereales", icon: "ü´ò", points: 3 },
            { name: "Polenta (125g)", category: "cereales", icon: "üåΩ", points: 3 },
            { name: "Semoule cuite (75g)", category: "cereales", icon: "üåæ", points: 2 },
            { name: "Semoule cuite (125g)", category: "cereales", icon: "üåæ", points: 3 },
            { name: "Pain de seigle (30g)", category: "cereales", icon: "üçû", points: 2 },
            { name: "Pain aux c√©r√©ales (30g)", category: "cereales", icon: "üçû", points: 2 },
            { name: "Crackers (5 unit√©s)", category: "cereales", icon: "üçû", points: 3 },
            { name: "Galettes de riz (3 unit√©s)", category: "cereales", icon: "üçö", points: 2 },
            { name: "Corn flakes (30g)", category: "cereales", icon: "ü•£", points: 3 },
            { name: "All Bran (30g)", category: "cereales", icon: "ü•£", points: 2 },
            { name: "Orge perl√© cuit (125g)", category: "cereales", icon: "üåæ", points: 3 },
            { name: "√âpeautre cuit (125g)", category: "cereales", icon: "üåæ", points: 3 },
            { name: "Sarrasin cuit (125g)", category: "cereales", icon: "üåæ", points: 3 },
            { name: "Patate douce (150g)", category: "cereales", icon: "üç†", points: 3 },
            { name: "Igname (150g)", category: "cereales", icon: "üç†", points: 3 },
            { name: "Tapioca cuit (125g)", category: "cereales", icon: "üåæ", points: 3 },
            { name: "Gnocchis (125g)", category: "cereales", icon: "ü•î", points: 4 },
            { name: "R√∂stis (1 portion)", category: "cereales", icon: "ü•î", points: 6 },
            { name: "R√∂stis (1/2 portion)", category: "cereales", icon: "ü•î", points: 3 },
            { name: "Pommes noisettes (100g)", category: "cereales", icon: "ü•î", points: 5 },
            { name: "Pommes noisettes (150g)", category: "cereales", icon: "ü•î", points: 8 },
            { name: "Pommes dauphine (100g)", category: "cereales", icon: "ü•î", points: 6 },
            { name: "Pommes duchesse (100g)", category: "cereales", icon: "ü•î", points: 5 },
            { name: "Pommes saut√©es (150g)", category: "cereales", icon: "ü•î", points: 5 },
            { name: "Pommes grenaille r√¥ties (150g)", category: "cereales", icon: "ü•î", points: 4 },
            { name: "Wedges √©pic√©es (100g)", category: "cereales", icon: "ü•î", points: 6 },
            { name: "Pain pita (1 unit√©)", category: "cereales", icon: "üçû", points: 3 },
            { name: "Pain naan (1 unit√©)", category: "cereales", icon: "üçû", points: 4 },
            { name: "Pain bagel (1 unit√©)", category: "cereales", icon: "ü•Ø", points: 5 },
            { name: "Pain su√©dois (2 tranches)", category: "cereales", icon: "üçû", points: 2 },
            { name: "Pain azyme (2 feuilles)", category: "cereales", icon: "üçû", points: 2 },
            { name: "Wrap tortilla (1 unit√©)", category: "cereales", icon: "üåØ", points: 3 },
            { name: "Pain burger (1 unit√©)", category: "cereales", icon: "üçî", points: 3 },
            { name: "Gressins (5 b√¢tons)", category: "cereales", icon: "ü•ñ", points: 2 },


            // C√©r√©ales petit-d√©jeuner suppl√©mentaires  
            { name: "Chocapic (30g)", category: "cereales", icon: "ü•£", points: 4 },
            { name: "Nesquik cereales (30g)", category: "cereales", icon: "ü•£", points: 4 },
            { name: "Frosties (30g)", category: "cereales", icon: "ü•£", points: 4 },
            { name: "Cookie Crisp (30g)", category: "cereales", icon: "ü•£", points: 4 },
            { name: "Lion cereales (30g)", category: "cereales", icon: "ü•£", points: 4 },
            { name: "Granola maison (30g)", category: "cereales", icon: "ü•£", points: 5 },
            { name: "Flocons d'avoine (30g)", category: "cereales", icon: "ü•£", points: 3 },
            { name: "Porridge avoine (portion)", category: "cereales", icon: "ü•£", points: 4 },
            { name: "Pancakes (2 unit√©s)", category: "cereales", icon: "ü•û", points: 6 },
            { name: "Gaufre de Li√®ge", category: "plaisir", icon: "üßá", points: 10 },
            { name: "Confiture (1 c.s)", category: "plaisir", icon: "üçì", points: 1 },
            { name: "Miel (1 c.s)", category: "plaisir", icon: "üçØ", points: 2 },
            { name: "Sirop d'√©rable (1 c.s)", category: "plaisir", icon: "üçÅ", points: 2 },
            { name: "P√¢te √† tartiner (1 c.s)", category: "plaisir", icon: "üç´", points: 3 },
            { name: "Beurre de cacahu√®te (1 c.s)", category: "plaisir", icon: "ü•ú", points: 3 },

            // Charcuterie
            { name: "Jambon blanc (50g)", category: "charcuterie", icon: "ü•ì", points: 2 },
            { name: "Jambon de Bayonne (30g)", category: "charcuterie", icon: "ü•ì", points: 3 },
            { name: "Jambon de Parme (30g)", category: "charcuterie", icon: "ü•ì", points: 3 },
            { name: "Saucisson sec (30g)", category: "charcuterie", icon: "ü•ì", points: 4 },
            { name: "Chorizo (30g)", category: "charcuterie", icon: "ü•ì", points: 4 },
            { name: "Rillettes (30g)", category: "charcuterie", icon: "ü•ì", points: 5 },
            { name: "P√¢t√© de campagne (30g)", category: "charcuterie", icon: "ü•ì", points: 4 },
            { name: "Mortadelle (30g)", category: "charcuterie", icon: "ü•ì", points: 3 },
            { name: "Bacon (20g)", category: "charcuterie", icon: "ü•ì", points: 4 },
            { name: "Lardons (30g)", category: "charcuterie", icon: "ü•ì", points: 4 },
            { name: "Boudin noir (50g)", category: "charcuterie", icon: "ü•ì", points: 5 },
            { name: "Merguez (1 unit√©)", category: "charcuterie", icon: "üå≠", points: 6 },
            { name: "Saucisse de Toulouse (1 unit√©)", category: "charcuterie", icon: "üå≠", points: 7 },
            { name: "Andouillette (100g)", category: "charcuterie", icon: "üå≠", points: 8 },
            { name: "Bresaola (30g)", category: "charcuterie", icon: "ü•ì", points: 2 },
            { name: "Coppa (30g)", category: "charcuterie", icon: "ü•ì", points: 4 },
            { name: "Rosette de Lyon (30g)", category: "charcuterie", icon: "ü•ì", points: 4 },
            { name: "Jambon de dinde (50g)", category: "charcuterie", icon: "ü¶É", points: 2 },
            { name: "Knacki (2 unit√©s)", category: "charcuterie", icon: "üå≠", points: 5 },
            { name: "Chipolata (2 unit√©s)", category: "charcuterie", icon: "üå≠", points: 6 },
            { name: "Boudin blanc (50g)", category: "charcuterie", icon: "ü•ì", points: 6 },
            { name: "Terrines diverses (30g)", category: "charcuterie", icon: "ü•ì", points: 4 },
            { name: "Foie gras (20g)", category: "charcuterie", icon: "ü¶Ü", points: 6 },
            { name: "Boudin aux pommes (80g)", category: "charcuterie", icon: "üçé", points: 7 },
            
            // Charcuterie grill√©e
            { name: "Chorizo grill√© (50g)", category: "charcuterie", icon: "üå∂Ô∏è", points: 6 },
            { name: "Merguez grill√©e (1 unit√©)", category: "charcuterie", icon: "üå≠", points: 7 },
            { name: "Saucisse grill√©e (1 unit√©)", category: "charcuterie", icon: "üå≠", points: 8 },
            { name: "Chipolata grill√©e (2 unit√©s)", category: "charcuterie", icon: "üå≠", points: 7 },
            { name: "Lardons grill√©s (40g)", category: "charcuterie", icon: "ü•ì", points: 5 },
            { name: "Bacon grill√© (30g)", category: "charcuterie", icon: "ü•ì", points: 5 },

            // Fast Food √©largi
            { name: "Big Mac", category: "fast_food", icon: "üçî", points: 17 },
            { name: "Royal Cheese", category: "fast_food", icon: "üçî", points: 15 },
            { name: "McChicken", category: "fast_food", icon: "üçî", points: 13 },
            { name: "Filet-O-Fish", category: "fast_food", icon: "üçî", points: 11 },
            { name: "Double Cheeseburger", category: "fast_food", icon: "üçî", points: 13 },
            { name: "Cheeseburger", category: "fast_food", icon: "üçî", points: 8 },
            { name: "Hamburger", category: "fast_food", icon: "üçî", points: 7 },
            { name: "Whopper Burger King", category: "fast_food", icon: "üçî", points: 16 },
            { name: "Big King", category: "fast_food", icon: "üçî", points: 14 },
            { name: "Chicken Royale", category: "fast_food", icon: "üçî", points: 13 },
            { name: "Frites McDonalds (petite)", category: "fast_food", icon: "üçü", points: 6 },
            { name: "Frites McDonalds (moyenne)", category: "fast_food", icon: "üçü", points: 9 },
            { name: "Frites McDonalds (grande)", category: "fast_food", icon: "üçü", points: 12 },
            { name: "Nuggets 4 pi√®ces", category: "fast_food", icon: "üçó", points: 5 },
            { name: "Nuggets 6 pi√®ces", category: "fast_food", icon: "üçó", points: 8 },
            { name: "Nuggets 9 pi√®ces", category: "fast_food", icon: "üçó", points: 12 },
            { name: "Nuggets 20 pi√®ces", category: "fast_food", icon: "üçó", points: 26 },
            { name: "McFlurry M&Ms", category: "fast_food", icon: "üç¶", points: 14 },
            { name: "McFlurry Oreo", category: "fast_food", icon: "üç¶", points: 14 },
            { name: "Sundae caramel", category: "fast_food", icon: "üç¶", points: 9 },
            { name: "Apple Pie McDonalds", category: "fast_food", icon: "ü•ß", points: 7 },
            { name: "Muffin McDonalds", category: "fast_food", icon: "üßÅ", points: 9 },
            { name: "McMuffin Egg & Bacon", category: "fast_food", icon: "üçî", points: 9 },
            { name: "McWrap Poulet", category: "fast_food", icon: "üåØ", points: 14 },
            { name: "Salade C√©sar McDonalds", category: "fast_food", icon: "ü•ó", points: 8 },
            { name: "Pizza Margherita (part)", category: "fast_food", icon: "üçï", points: 8 },
            { name: "Pizza 4 fromages (part)", category: "fast_food", icon: "üçï", points: 9 },
            { name: "Pizza Pepperoni (part)", category: "fast_food", icon: "üçï", points: 10 },
            { name: "Pizza Calzone", category: "fast_food", icon: "üçï", points: 12 },
            { name: "Pizza Hut Supreme (part)", category: "fast_food", icon: "üçï", points: 11 },
            { name: "Pizza Hut Hawa√Øenne (part)", category: "fast_food", icon: "üçï", points: 9 },
            { name: "Pizza Hut Cheesy Crust (part)", category: "fast_food", icon: "üçï", points: 12 },
            { name: "Domino's Margherita (part)", category: "fast_food", icon: "üçï", points: 8 },
            { name: "Domino's Extravaganza (part)", category: "fast_food", icon: "üçï", points: 11 },
            { name: "Domino's BBQ Chicken (part)", category: "fast_food", icon: "üçï", points: 10 },
            { name: "Domino's Cheese Bread", category: "fast_food", icon: "üçû", points: 8 },
            { name: "Tacos 1 viande", category: "fast_food", icon: "üåÆ", points: 14 },
            { name: "Tacos 2 viandes", category: "fast_food", icon: "üåÆ", points: 17 },
            { name: "Tacos 3 viandes", category: "fast_food", icon: "üåÆ", points: 20 },
            { name: "Kebab complet", category: "fast_food", icon: "ü•ô", points: 20 },
            { name: "Kebab assiette", category: "fast_food", icon: "ü•ô", points: 22 },
            { name: "Falafel sandwich", category: "street_food", icon: "ü•ô", points: 11 },
            { name: "Subway 15cm poulet", category: "fast_food", icon: "ü•™", points: 8 },
            { name: "Subway 30cm poulet", category: "fast_food", icon: "ü•™", points: 16 },
            { name: "Subway 15cm thon", category: "fast_food", icon: "ü•™", points: 10 },
            { name: "Subway 30cm thon", category: "fast_food", icon: "ü•™", points: 20 },
            { name: "Subway 15cm v√©g√©tarien", category: "fast_food", icon: "ü•™", points: 6 },
            { name: "Subway Cookie", category: "fast_food", icon: "üç™", points: 6 },  
            { name: "KFC Tower Burger", category: "fast_food", icon: "üçî", points: 16 },
            { name: "KFC Zinger", category: "fast_food", icon: "üçî", points: 15 },
            { name: "KFC Bucket 6 pi√®ces", category: "fast_food", icon: "üçó", points: 28 },
            { name: "KFC Tenders (3 pi√®ces)", category: "fast_food", icon: "üçó", points: 9 },
            { name: "KFC Hot Wings (6 pi√®ces)", category: "fast_food", icon: "üçó", points: 11 },
            { name: "KFC Popcorn Chicken", category: "fast_food", icon: "üçó", points: 10 },
            { name: "Onion Rings (6 pi√®ces)", category: "fast_food", icon: "üßÖ", points: 7 },
            { name: "Whopper", category: "fast_food", icon: "üçî", points: 18 },
            { name: "Double Whopper", category: "fast_food", icon: "üçî", points: 26 },
            { name: "Big King", category: "fast_food", icon: "üçî", points: 16 },
            { name: "Chicken Royale", category: "fast_food", icon: "üçî", points: 15 },
            { name: "Long Chicken", category: "fast_food", icon: "üçî", points: 14 },
            { name: "Steakhouse", category: "fast_food", icon: "üçî", points: 20 },
            { name: "King Wings (6 pi√®ces)", category: "fast_food", icon: "üçó", points: 10 },
            { name: "Onion Rings (6 pi√®ces)", category: "fast_food", icon: "üßÖ", points: 9 },
            { name: "King Fries (moyenne)", category: "fast_food", icon: "üçü", points: 10 },
            { name: "Quick Giant", category: "fast_food", icon: "üçî", points: 16 },
            { name: "Quick Cheese", category: "fast_food", icon: "üçî", points: 14 },
            { name: "Quick'N Toast", category: "fast_food", icon: "üçî", points: 13 },
            { name: "Starbucks Muffin", category: "fast_food", icon: "üßÅ", points: 11 },
            { name: "Starbucks Cookie", category: "fast_food", icon: "üç™", points: 9 },

            // Street Food √©largi
            { name: "Cr√™pe Nutella", category: "street_food", icon: "ü•û", points: 12 },
            { name: "Cr√™pe sucre", category: "street_food", icon: "ü•û", points: 8 },
            { name: "Cr√™pe beurre", category: "street_food", icon: "ü•û", points: 6 },
            { name: "Cr√™pe confiture", category: "street_food", icon: "ü•û", points: 9 },
            { name: "Galette compl√®te", category: "street_food", icon: "ü•û", points: 11 },
            { name: "Galette jambon-fromage", category: "street_food", icon: "ü•û", points: 9 },
            { name: "Gaufre nature", category: "street_food", icon: "üßá", points: 6 },
            { name: "Gaufre Nutella", category: "street_food", icon: "üßá", points: 10 },
            { name: "Gaufre chantilly", category: "street_food", icon: "üßá", points: 9 },
            { name: "Hot-dog", category: "street_food", icon: "üå≠", points: 10 },
            { name: "Hot-dog fromage", category: "street_food", icon: "üå≠", points: 12 },
            { name: "Sandwich jambon-beurre", category: "street_food", icon: "ü•™", points: 8 },
            { name: "Sandwich poulet-crudit√©s", category: "street_food", icon: "ü•™", points: 9 },
            { name: "Panini jambon-fromage", category: "street_food", icon: "ü•™", points: 10 },
            { name: "Panini 3 fromages", category: "street_food", icon: "ü•™", points: 12 },
            { name: "Croque-monsieur", category: "street_food", icon: "ü•™", points: 11 },
            { name: "Croque-madame", category: "street_food", icon: "ü•™", points: 13 },
            { name: "Churros (5 pi√®ces)", category: "street_food", icon: "üç©", points: 8 },
            { name: "Beignet", category: "street_food", icon: "üç©", points: 6 },
            { name: "Socca (part)", category: "street_food", icon: "ü•û", points: 4 },
            
            // Plats cuisin√©s/maison consid√©rablement √©largis
            { name: "Lasagnes bolognaise (portion)", category: "plats_cuisines", icon: "üçù", points: 12 },
            { name: "Lasagnes √©pinards-ricotta (portion)", category: "plats_cuisines", icon: "üçù", points: 11 },
            { name: "P√¢tes √† la carbonara (portion)", category: "plats_cuisines", icon: "üçù", points: 14 },
            { name: "P√¢tes √† la bolognaise (portion)", category: "plats_cuisines", icon: "üçù", points: 10 },
            { name: "P√¢tes pesto (portion)", category: "plats_cuisines", icon: "üçù", points: 13 },
            { name: "P√¢tes aux 4 fromages (portion)", category: "plats_cuisines", icon: "üçù", points: 15 },
            { name: "Spaghettis aglio e olio (portion)", category: "plats_cuisines", icon: "üçù", points: 8 },
            { name: "Risotto aux champignons (portion)", category: "plats_cuisines", icon: "üçö", points: 11 },
            { name: "Risotto parmesan (portion)", category: "plats_cuisines", icon: "üçö", points: 12 },
            { name: "Paella (portion)", category: "plats_cuisines", icon: "ü•ò", points: 13 },
            { name: "Gratin dauphinois (portion)", category: "plats_cuisines", icon: "ü•î", points: 10 },
            { name: "Gratin de courgettes (portion)", category: "plats_cuisines", icon: "ü•í", points: 8 },
            { name: "Quiche lorraine (part)", category: "plats_cuisines", icon: "ü•ß", points: 9 },
            { name: "Quiche aux √©pinards (part)", category: "plats_cuisines", icon: "ü•ß", points: 8 },
            { name: "Tarte flamb√©e (part)", category: "plats_cuisines", icon: "ü•ß", points: 7 },
            { name: "Couscous royal (portion)", category: "plats_cuisines", icon: "üç≤", points: 16 },
            { name: "Couscous poulet (portion)", category: "plats_cuisines", icon: "üç≤", points: 14 },
            { name: "Tajine agneau (portion)", category: "plats_cuisines", icon: "üç≤", points: 13 },
            { name: "Pot-au-feu (portion)", category: "plats_cuisines", icon: "üç≤", points: 8 },
            { name: "Blanquette de veau (portion)", category: "plats_cuisines", icon: "üç≤", points: 12 },
            { name: "B≈ìuf bourguignon (portion)", category: "plats_cuisines", icon: "üç≤", points: 11 },
            { name: "Cassoulet (portion)", category: "plats_cuisines", icon: "üç≤", points: 15 },
            { name: "Choucroute (portion)", category: "plats_cuisines", icon: "üç≤", points: 18 },
            { name: "Ratatouille (portion)", category: "plats_cuisines", icon: "üç≤", points: 4 },
            { name: "Curry de poulet (portion)", category: "plats_cuisines", icon: "üçõ", points: 12 },
            { name: "Chili con carne (portion)", category: "plats_cuisines", icon: "üç≤", points: 10 },
            { name: "Hachis parmentier (portion)", category: "plats_cuisines", icon: "ü•î", points: 11 },
            { name: "Moussaka (portion)", category: "plats_cuisines", icon: "üçÜ", points: 13 },
            { name: "Tartiflette (portion)", category: "plats_cuisines", icon: "ü•î", points: 15 },
            { name: "Raclette (portion)", category: "plats_cuisines", icon: "üßÄ", points: 18 },
            { name: "Fondue savoyarde (portion)", category: "plats_cuisines", icon: "üßÄ", points: 20 },
            { name: "Bouillabaisse (portion)", category: "plats_cuisines", icon: "üç≤", points: 9 },
            { name: "Fish & chips (portion)", category: "plats_cuisines", icon: "üçü", points: 16 },
            { name: "Escalope milanaise", category: "plats_cuisines", icon: "ü•©", points: 12 },
            { name: "Cordon bleu (1 unit√©)", category: "plats_cuisines", icon: "ü•©", points: 10 },
            { name: "Steak frites (portion)", category: "plats_cuisines", icon: "ü•©", points: 15 },
            { name: "Sushi set (12 pi√®ces)", category: "plats_cuisines", icon: "üç£", points: 8 },
            { name: "Sashimi (6 pi√®ces)", category: "plats_cuisines", icon: "üç£", points: 4 },
            { name: "Chirashi (bol)", category: "plats_cuisines", icon: "üç£", points: 12 },
            { name: "Accras de morue (4 pi√®ces)", category: "plats_cuisines", icon: "üêü", points: 8 },
            { name: "Accras de morue (2 pi√®ces)", category: "plats_cuisines", icon: "üêü", points: 4 },
            { name: "Beignets de crevettes (4 pi√®ces)", category: "plats_cuisines", icon: "ü¶ê", points: 6 },
            { name: "Tempura de l√©gumes (portion)", category: "plats_cuisines", icon: "ü•¶", points: 8 },
            { name: "Samossas l√©gumes (2 pi√®ces)", category: "plats_cuisines", icon: "ü•ü", points: 5 },
            { name: "Samossas viande (2 pi√®ces)", category: "plats_cuisines", icon: "ü•ü", points: 6 },
            { name: "Nems poulet (2 pi√®ces)", category: "plats_cuisines", icon: "ü•ü", points: 6 },
            { name: "Nems crevettes (2 pi√®ces)", category: "plats_cuisines", icon: "ü•ü", points: 5 },
            { name: "Gyoza (6 pi√®ces)", category: "plats_cuisines", icon: "ü•ü", points: 7 },
            { name: "Raviolis vapeur (6 pi√®ces)", category: "plats_cuisines", icon: "ü•ü", points: 6 },
            { name: "Bouch√©es √† la reine (2 pi√®ces)", category: "plats_cuisines", icon: "ü•ß", points: 10 },
            { name: "Vol-au-vent (1 pi√®ce)", category: "plats_cuisines", icon: "ü•ß", points: 8 },
            { name: "Feuillet√© saumon (1 pi√®ce)", category: "plats_cuisines", icon: "üêü", points: 7 },
            { name: "Tourte aux l√©gumes (portion)", category: "plats_cuisines", icon: "ü•ß", points: 9 },
            { name: "P√¢t√© en cro√ªte (tranche)", category: "plats_cuisines", icon: "ü•ß", points: 8 },
            { name: "Flamiche aux poireaux (part)", category: "plats_cuisines", icon: "ü•ß", points: 8 },
            { name: "Pissaladi√®re (part)", category: "plats_cuisines", icon: "üçï", points: 7 },
            { name: "Socca ni√ßoise (portion)", category: "plats_cuisines", icon: "ü•û", points: 4 },
            { name: "Falafels (4 pi√®ces)", category: "plats_cuisines", icon: "üßÜ", points: 6 },
            { name: "Houmous (100g)", category: "plats_cuisines", icon: "ü•£", points: 4 },
            { name: "Tzatziki (100g)", category: "plats_cuisines", icon: "ü•£", points: 3 },
            { name: "Guacamole (100g)", category: "plats_cuisines", icon: "ü•ë", points: 5 },
            { name: "Tapenade (50g)", category: "plats_cuisines", icon: "ü´í", points: 4 },
            { name: "Caviar d'aubergine (100g)", category: "plats_cuisines", icon: "üçÜ", points: 3 },
            { name: "Rougail saucisse (portion)", category: "plats_cuisines", icon: "üç≤", points: 14 },
            { name: "Carry poulet (portion)", category: "plats_cuisines", icon: "üç≤", points: 12 },
            { name: "Carry poisson (portion)", category: "plats_cuisines", icon: "üç≤", points: 10 },
            { name: "Bouchons vapeur (4 pi√®ces)", category: "plats_cuisines", icon: "ü•ü", points: 8 },
            { name: "Samoussas (2 pi√®ces)", category: "plats_cuisines", icon: "ü•ü", points: 7 },
            { name: "Dholl puri (1 unit√©)", category: "plats_cuisines", icon: "ü´ì", points: 9 },
            { name: "Mine frit (portion)", category: "plats_cuisines", icon: "üçú", points: 12 },
            { name: "Riz cantonnais (portion)", category: "plats_cuisines", icon: "üçö", points: 11 },
            { name: "Sushi saumon (6 pi√®ces)", category: "plats_cuisines", icon: "üç£", points: 6 },
            { name: "California rolls (6 pi√®ces)", category: "plats_cuisines", icon: "üç£", points: 8 },
            { name: "Maki concombre (6 pi√®ces)", category: "plats_cuisines", icon: "üç£", points: 4 },
            { name: "Sashimi saumon (6 pi√®ces)", category: "plats_cuisines", icon: "üç£", points: 5 },
            { name: "Chirashi bowl", category: "plats_cuisines", icon: "üç£", points: 14 },
            { name: "Tempura crevettes (6 pi√®ces)", category: "plats_cuisines", icon: "üç§", points: 10 },
            
            // Desserts et glaces consid√©rablement √©largis
            { name: "Tiramisu (portion)", category: "desserts", icon: "üç®", points: 8 },
            { name: "Tarte aux pommes (part)", category: "desserts", icon: "ü•ß", points: 7 },
            { name: "Tarte au citron (part)", category: "desserts", icon: "ü•ß", points: 8 },
            { name: "Tarte aux fraises (part)", category: "desserts", icon: "ü•ß", points: 7 },
            { name: "Tarte Tatin (part)", category: "desserts", icon: "ü•ß", points: 9 },
            { name: "Clafoutis (part)", category: "desserts", icon: "üç∞", points: 6 },
            { name: "Mousse au chocolat", category: "desserts", icon: "üçÆ", points: 6 },
            { name: "Mousse aux fruits", category: "desserts", icon: "üçÆ", points: 5 },
            { name: "Panna cotta", category: "desserts", icon: "üçÆ", points: 6 },
            { name: "Cr√®me br√ªl√©e", category: "desserts", icon: "üçÆ", points: 7 },
            { name: "√éle flottante", category: "desserts", icon: "üçÆ", points: 5 },
            { name: "Profiteroles (3 pi√®ces)", category: "desserts", icon: "üç∞", points: 10 },
            { name: "√âclair au chocolat", category: "desserts", icon: "üç∞", points: 8 },
            { name: "√âclair au caf√©", category: "desserts", icon: "üç∞", points: 8 },
            { name: "Religieuse", category: "desserts", icon: "üç∞", points: 10 },
            { name: "Paris-Brest", category: "desserts", icon: "üç∞", points: 12 },
            { name: "Mille-feuille", category: "desserts", icon: "üç∞", points: 11 },
            { name: "Opera", category: "desserts", icon: "üç∞", points: 9 },
            { name: "For√™t noire (part)", category: "desserts", icon: "üç∞", points: 12 },
            { name: "Cheesecake (part)", category: "desserts", icon: "üç∞", points: 11 },
            { name: "Brownie", category: "desserts", icon: "üç∞", points: 8 },
            { name: "Muffin chocolat", category: "desserts", icon: "üßÅ", points: 7 },
            { name: "Cupcake", category: "desserts", icon: "üßÅ", points: 6 },
            { name: "Donut nature", category: "desserts", icon: "üç©", points: 6 },
            { name: "Donut glac√©", category: "desserts", icon: "üç©", points: 8 },
            { name: "Yaourt aux fruits", category: "desserts", icon: "üç®", points: 4 },
            { name: "Compote de pommes", category: "desserts", icon: "üçé", points: 2 },
            { name: "Salade de fruits", category: "desserts", icon: "üçì", points: 3 },
            { name: "Glace vanille (2 boules)", category: "desserts", icon: "üç¶", points: 6 },
            { name: "Glace chocolat (2 boules)", category: "desserts", icon: "üç¶", points: 7 },
            { name: "Glace fraise (2 boules)", category: "desserts", icon: "üç¶", points: 6 },
            { name: "Sorbet citron (2 boules)", category: "desserts", icon: "üçß", points: 4 },
            { name: "Sorbet fruits (2 boules)", category: "desserts", icon: "üçß", points: 4 },
            { name: "Calippo", category: "desserts", icon: "üç≠", points: 5 },
            { name: "Mister Freeze", category: "desserts", icon: "üç≠", points: 1 },
            { name: "Glace √† l'eau (1 b√¢tonnet)", category: "desserts", icon: "üç≠", points: 1 },
            { name: "Esquimau vanille", category: "desserts", icon: "üç¶", points: 4 },
            { name: "Magnum Classic", category: "desserts", icon: "üç¶", points: 8 },
            { name: "Magnum Amandes", category: "desserts", icon: "üç¶", points: 9 },
            { name: "Cornetto", category: "desserts", icon: "üç¶", points: 7 },
            { name: "Twister", category: "desserts", icon: "üç¶", points: 4 },
            { name: "Solero", category: "desserts", icon: "üç¶", points: 4 },
            { name: "Ben & Jerry's (125ml)", category: "desserts", icon: "üç¶", points: 8 },
            { name: "H√§agen-Dazs (125ml)", category: "desserts", icon: "üç¶", points: 9 },
            { name: "Glace vanille (1 boule)", category: "plaisir", icon: "üç¶", points: 3 },
            { name: "Glace chocolat (1 boule)", category: "plaisir", icon: "üç¶", points: 3 },
            { name: "Glace fraise (1 boule)", category: "plaisir", icon: "üç¶", points: 3 },
            { name: "Sorbet citron (1 boule)", category: "plaisir", icon: "üç¶", points: 2 },
            { name: "Sorbet fruits rouges (1 boule)", category: "plaisir", icon: "üç¶", points: 2 },
            { name: "Magnum classique", category: "plaisir", icon: "üç¶", points: 7 },
            { name: "Esquimau", category: "plaisir", icon: "üç¶", points: 4 },

            // Suppl√©ments musculation √©largis
            { name: "Prot√©ine whey nature (30g)", category: "supplements", icon: "üí™", points: 3 },
            { name: "Prot√©ine whey chocolat (30g)", category: "supplements", icon: "üí™", points: 3 },
            { name: "Prot√©ine whey vanille (30g)", category: "supplements", icon: "üí™", points: 3 },
            { name: "Prot√©ine cas√©ine (30g)", category: "supplements", icon: "üí™", points: 3 },
            { name: "Prot√©ine v√©g√©tale (30g)", category: "supplements", icon: "üí™", points: 3 },
            { name: "Isolate whey (30g)", category: "supplements", icon: "üí™", points: 3 },
            { name: "Mass gainer (60g)", category: "supplements", icon: "üí™", points: 8 },
            { name: "BCAA poudre (10g)", category: "supplements", icon: "üíä", points: 0 },
            { name: "BCAA comprim√©s (5 unit√©s)", category: "supplements", icon: "üíä", points: 0 },
            { name: "Cr√©atine monohydrate (5g)", category: "supplements", icon: "üíä", points: 0 },
            { name: "Cr√©atine HCL (3g)", category: "supplements", icon: "üíä", points: 0 },
            { name: "Pre-workout (portion)", category: "supplements", icon: "üíä", points: 1 },
            { name: "Glutamine (10g)", category: "supplements", icon: "üíä", points: 1 },
            { name: "HMB (3g)", category: "supplements", icon: "üíä", points: 0 },
            { name: "Barre prot√©in√©e 20g", category: "supplements", icon: "üç´", points: 5 },
            { name: "Barre prot√©in√©e 30g", category: "supplements", icon: "üç´", points: 7 },
            { name: "Cookie prot√©in√©", category: "supplements", icon: "üç™", points: 4 },
            { name: "Pancake prot√©in√© (mix)", category: "supplements", icon: "ü•û", points: 6 },
            { name: "Avoine prot√©in√©e (portion)", category: "supplements", icon: "ü•£", points: 7 },
            { name: "Beurre de cacahu√®te fit (20g)", category: "supplements", icon: "ü•ú", points: 3 },
            { name: "ZMA (3 capsules)", category: "supplements", icon: "üíä", points: 0 },
            { name: "Om√©ga 3 (2 capsules)", category: "supplements", icon: "üíä", points: 0 },
            { name: "Multivitamines (1 comprim√©)", category: "supplements", icon: "üíä", points: 0 },
            { name: "CLA (2 capsules)", category: "supplements", icon: "üíä", points: 0 },
            { name: "L-Carnitine (portion)", category: "supplements", icon: "üíä", points: 0 },
            
            // Sauces consid√©rablement √©largies
            { name: "Huile d'olive (1 c.s)", category: "sauces", icon: "ü´í", points: 3 },
            { name: "Huile de tournesol (1 c.s)", category: "sauces", icon: "üåª", points: 3 },
            { name: "Huile de colza (1 c.s)", category: "sauces", icon: "üåª", points: 3 },
            { name: "Huile de coco (1 c.s)", category: "sauces", icon: "ü••", points: 3 },
            { name: "Beurre doux (10g)", category: "sauces", icon: "üßà", points: 2 },
            { name: "Beurre sal√© (10g)", category: "sauces", icon: "üßà", points: 2 },
            { name: "Margarine (10g)", category: "sauces", icon: "üßà", points: 2 },
            { name: "Mayonnaise (1 c.s)", category: "sauces", icon: "ü•Ñ", points: 3 },
            { name: "Mayonnaise all√©g√©e (1 c.s)", category: "sauces", icon: "ü•Ñ", points: 1 },
            { name: "A√Øoli (1 c.s)", category: "sauces", icon: "ü•Ñ", points: 3 },
            { name: "Sauce blanche (1 c.s)", category: "sauces", icon: "ü•Ñ", points: 2 },
            { name: "Sauce cocktail (1 c.s)", category: "sauces", icon: "ü•Ñ", points: 2 },
            { name: "Sauce tartare (1 c.s)", category: "sauces", icon: "ü•Ñ", points: 3 },
            { name: "Ketchup (1 c.s)", category: "sauces", icon: "ü•Ñ", points: 1 },
            { name: "Moutarde de Dijon (1 c.s)", category: "sauces", icon: "ü•Ñ", points: 0 },
            { name: "Moutarde √† l'ancienne (1 c.s)", category: "sauces", icon: "ü•Ñ", points: 0 },
            { name: "Moutarde au miel (1 c.s)", category: "sauces", icon: "ü•Ñ", points: 1 },
            { name: "Vinaigrette (1 c.s)", category: "sauces", icon: "ü•Ñ", points: 2 },
            { name: "Vinaigrette all√©g√©e (1 c.s)", category: "sauces", icon: "ü•Ñ", points: 1 },
            { name: "Sauce soja (1 c.s)", category: "sauces", icon: "ü•Ñ", points: 0 },
            { name: "Sauce teriyaki (1 c.s)", category: "sauces", icon: "ü•Ñ", points: 1 },
            { name: "Sauce barbecue (1 c.s)", category: "sauces", icon: "ü•Ñ", points: 1 },
            { name: "Tabasco (1 c.c)", category: "sauces", icon: "üå∂Ô∏è", points: 0 },
            { name: "Harissa (1 c.c)", category: "sauces", icon: "üå∂Ô∏è", points: 0 },
            { name: "Pesto (1 c.s)", category: "sauces", icon: "ü•Ñ", points: 3 },
            { name: "Tapenade (1 c.s)", category: "sauces", icon: "ü•Ñ", points: 2 },
            { name: "Cr√®me fra√Æche (1 c.s)", category: "sauces", icon: "ü•Ñ", points: 2 },
            { name: "Cr√®me fra√Æche all√©g√©e (1 c.s)", category: "sauces", icon: "ü•Ñ", points: 1 },
            { name: "B√©chamel (2 c.s)", category: "sauces", icon: "ü•Ñ", points: 3 },
            { name: "Sauce tomate (2 c.s)", category: "sauces", icon: "üçÖ", points: 1 },
            { name: "Coulis de tomate (2 c.s)", category: "sauces", icon: "üçÖ", points: 0 },               
            { name: "Sauce hollandaise (2 c.s)", category: "sauces", icon: "ü•Ñ", points: 4 },
            { name: "Sauce b√©arnaise (2 c.s)", category: "sauces", icon: "ü•Ñ", points: 4 },
            { name: "Sauce au poivre (2 c.s)", category: "sauces", icon: "ü•Ñ", points: 3 },
            { name: "Sauce champignons (2 c.s)", category: "sauces", icon: "üçÑ", points: 2 },
            { name: "Sauce curry (2 c.s)", category: "sauces", icon: "ü•Ñ", points: 2 },
            { name: "Sauce aigre-douce (2 c.s)", category: "sauces", icon: "ü•Ñ", points: 3 },
            { name: "Sauce satay (2 c.s)", category: "sauces", icon: "ü•Ñ", points: 4 },
            { name: "Sauce ranch (1 c.s)", category: "sauces", icon: "ü•Ñ", points: 2 },
            { name: "Sauce caesar (1 c.s)", category: "sauces", icon: "ü•Ñ", points: 2 },
            { name: "Sauce mille-√Æles (1 c.s)", category: "sauces", icon: "ü•Ñ", points: 2 },
            { name: "Margarine (10g)", category: "sauces", icon: "üßà", points: 2 },
            { name: "Margarine all√©g√©e (10g)", category: "sauces", icon: "üßà", points: 1 },
            
            // Condiments et √©pices
            { name: "Sel (1 pinc√©e)", category: "sauces", icon: "üßÇ", points: 0 },
            { name: "Poivre (1 pinc√©e)", category: "sauces", icon: "üå∂Ô∏è", points: 0 },
            { name: "Paprika (1 c.c)", category: "sauces", icon: "üå∂Ô∏è", points: 0 },
            { name: "Cumin (1 c.c)", category: "sauces", icon: "üåø", points: 0 },
            { name: "Thym (1 c.c)", category: "sauces", icon: "üåø", points: 0 },
            { name: "Basilic (1 c.c)", category: "sauces", icon: "üåø", points: 0 },
            { name: "Persil (1 c.s)", category: "sauces", icon: "üåø", points: 0 },
            { name: "Ciboulette (1 c.s)", category: "sauces", icon: "üåø", points: 0 },
            { name: "Ail (1 gousse)", category: "sauces", icon: "üßÑ", points: 0 },
            { name: "Oignon (1 moyen)", category: "legumes", icon: "üßÖ", points: 1 },
            { name: "√âchalote (2 unit√©s)", category: "legumes", icon: "üßÖ", points: 0 },

            // Plaisirs
            { name: "Chocolat noir 70% (20g)", category: "plaisir", icon: "üç´", points: 3 },
            { name: "Chocolat noir 85% (20g)", category: "plaisir", icon: "üç´", points: 3 },
            { name: "Chocolat au lait (20g)", category: "plaisir", icon: "üç´", points: 4 },
            { name: "Chocolat blanc (20g)", category: "plaisir", icon: "üç´", points: 4 },
            { name: "Nutella (20g)", category: "plaisir", icon: "üç´", points: 3 },
            { name: "Bonbons g√©lifi√©s (30g)", category: "plaisir", icon: "üç¨", points: 3 },
            { name: "Bonbons au chocolat (30g)", category: "plaisir", icon: "üç¨", points: 4 },
            { name: "Caramels (30g)", category: "plaisir", icon: "üç¨", points: 3 },
            { name: "Cookies (2 pi√®ces)", category: "plaisir", icon: "üç™", points: 6 },
            { name: "Petits beurres (4 pi√®ces)", category: "plaisir", icon: "üç™", points: 4 },
            { name: "Madeleines (2 pi√®ces)", category: "plaisir", icon: "üç™", points: 5 },
            { name: "Chips nature (30g)", category: "plaisir", icon: "ü•î", points: 4 },
            { name: "Chips saveur (30g)", category: "plaisir", icon: "ü•î", points: 4 },
            { name: "Biscuits ap√©ritif (30g)", category: "plaisir", icon: "ü•®", points: 4 },
            { name: "Cacahu√®tes (30g)", category: "plaisir", icon: "ü•ú", points: 5 },
            { name: "Amandes (30g)", category: "plaisir", icon: "ü•ú", points: 5 },
            { name: "Noix (30g)", category: "plaisir", icon: "ü•ú", points: 6 },
            { name: "Pistaches (30g)", category: "plaisir", icon: "ü•ú", points: 5 },
            { name: "Pop-corn (30g)", category: "plaisir", icon: "üçø", points: 3 },
            { name: "Barbe √† papa", category: "plaisir", icon: "üç≠", points: 3 },
            { name: "Marshmallows (30g)", category: "plaisir", icon: "üç≠", points: 3 },
            { name: "Noix de cajou (30g)", category: "plaisir", icon: "ü•ú", points: 5 },
            { name: "Rosi (30g)", category: "plaisir", icon: "ü•ú", points: 6 },
            { name: "Noisettes (30g)", category: "plaisir", icon: "ü•ú", points: 5 },
            { name: "Pignons de pin (30g)", category: "plaisir", icon: "ü•ú", points: 6 },
            { name: "Graines de tournesol (30g)", category: "plaisir", icon: "üåª", points: 5 },
            { name: "Graines de courge (30g)", category: "plaisir", icon: "üéÉ", points: 4 },
            { name: "M√©lange de fruits secs (30g)", category: "plaisir", icon: "ü•ú", points: 5 },
            { name: "Noix de p√©can (30g)", category: "plaisir", icon: "ü•ú", points: 6 },
            { name: "Noix du Br√©sil (30g)", category: "plaisir", icon: "ü•ú", points: 6 },
            { name: "Crackers ap√©ritif (15g)", category: "plaisir", icon: "üçò", points: 2 },
            { name: "Bretzels (30g)", category: "plaisir", icon: "ü•®", points: 3 },
            { name: "Tortilla chips (30g)", category: "plaisir", icon: "üåÆ", points: 4 },
            { name: "Popcorn sal√© (50g)", category: "plaisir", icon: "üçø", points: 5 },
            { name: "Popcorn caramel (30g)", category: "plaisir", icon: "üçø", points: 4 },
            { name: "Cacahu√®tes grill√©es sal√©es (15g)", category: "plaisir", icon: "ü•ú", points: 3 },
            { name: "Mix ap√©ritif (30g)", category: "plaisir", icon: "ü•ú", points: 5 },
            { name: "Olives vertes (10 unit√©s)", category: "plaisir", icon: "ü´í", points: 1 },
            { name: "Olives noires (10 unit√©s)", category: "plaisir", icon: "ü´í", points: 2 },
            { name: "Cornichons (5 unit√©s)", category: "plaisir", icon: "ü•í", points: 0 },

            // P√¢tisseries et desserts suppl√©mentaires
            { name: "Tarte aux pommes (1 part)", category: "plaisir", icon: "ü•ß", points: 8 },
            { name: "Tarte aux fraises (1 part)", category: "plaisir", icon: "ü•ß", points: 9 },
            { name: "Tarte au citron (1 part)", category: "plaisir", icon: "ü•ß", points: 10 },
            { name: "Tarte tatin (1 part)", category: "plaisir", icon: "ü•ß", points: 12 },
            { name: "Millefeuille", category: "plaisir", icon: "üßÅ", points: 14 },
            { name: "Saint-Honor√©", category: "plaisir", icon: "üßÅ", points: 16 },
            { name: "Op√©ra", category: "plaisir", icon: "üç∞", points: 12 },
            { name: "Fraisier (1 part)", category: "plaisir", icon: "üç∞", points: 11 },
            { name: "For√™t noire (1 part)", category: "plaisir", icon: "üç∞", points: 13 },
            { name: "Tiramisu (1 part)", category: "plaisir", icon: "üç∞", points: 10 },
            { name: "Profiteroles (3 pi√®ces)", category: "plaisir", icon: "üßÅ", points: 12 },
            { name: "Millefeuille", category: "plaisir", icon: "üßÅ", points: 15 },
            { name: "Flan p√¢tissier (1 part)", category: "plaisir", icon: "üçÆ", points: 7 },
            { name: "Clafoutis (1 part)", category: "plaisir", icon: "üçÆ", points: 6 },
            { name: "Far breton (1 part)", category: "plaisir", icon: "üçÆ", points: 8 },

            // Viennoiseries
            { name: "Mini pain au chocolat", category: "plaisir", icon: "ü•ê", points: 4 },
            { name: "Pain au chocolat", category: "plaisir", icon: "ü•ê", points: 8 },
            { name: "Mini croissant", category: "plaisir", icon: "ü•ê", points: 3 },
            { name: "Croissant", category: "plaisir", icon: "ü•ê", points: 6 },
            { name: "Pain suisse", category: "plaisir", icon: "ü•ê", points: 8 },
            { name: "Chocolatine", category: "plaisir", icon: "ü•ê", points: 8 },
            { name: "Pain aux raisins", category: "plaisir", icon: "ü•ê", points: 8 },
            { name: "Chausson aux pommes", category: "plaisir", icon: "ü•ê", points: 9 },
            { name: "Brioche nature", category: "plaisir", icon: "üçû", points: 6 },
            { name: "Brioche aux p√©pites", category: "plaisir", icon: "üçû", points: 8 },
            { name: "Pain viennois", category: "plaisir", icon: "ü•ñ", points: 5 },
            { name: "Chouquette (5 pi√®ces)", category: "plaisir", icon: "üßÅ", points: 4 },
            { name: "√âclair au chocolat", category: "plaisir", icon: "üßÅ", points: 10 },
            { name: "√âclair au caf√©", category: "plaisir", icon: "üßÅ", points: 9 },
            { name: "Religieuse au chocolat", category: "plaisir", icon: "üßÅ", points: 12 },
            { name: "Paris-Brest", category: "plaisir", icon: "üßÅ", points: 15 },
            { name: "Chou √† la cr√®me", category: "plaisir", icon: "üßÅ", points: 8 },
            { name: "Palmier", category: "plaisir", icon: "ü•ê", points: 6 },
            { name: "Torsade aux p√©pites", category: "plaisir", icon: "ü•ê", points: 7 },
            { name: "Danish aux fruits", category: "plaisir", icon: "ü•ê", points: 8 },

            // Boissons consid√©rablement √©largies
            { name: "Eau plate (illimit√©)", category: "boissons", icon: "üíß", points: 0 },
            { name: "Eau gazeuse (illimit√©)", category: "boissons", icon: "üíß", points: 0 },
            { name: "Th√© nature (sans sucre)", category: "boissons", icon: "üçµ", points: 0 },
            { name: "Th√© vert (sans sucre)", category: "boissons", icon: "üçµ", points: 0 },
            { name: "Tisane (sans sucre)", category: "boissons", icon: "üçµ", points: 0 },
            { name: "Caf√© noir (sans sucre)", category: "boissons", icon: "‚òï", points: 0 },
            { name: "Caf√© 1 sucre", category: "boissons", icon: "‚òï", points: 1 },
            { name: "Caf√© 2 sucres", category: "boissons", icon: "‚òï", points: 2 },
            { name: "Caf√© au lait", category: "boissons", icon: "‚òï", points: 2 },
            { name: "Cappuccino", category: "boissons", icon: "‚òï", points: 3 },
            { name: "Latte", category: "boissons", icon: "‚òï", points: 4 },
            { name: "Chocolat chaud", category: "boissons", icon: "‚òï", points: 6 },
            { name: "Coca-Cola (33cl)", category: "boissons", icon: "ü•§", points: 5 },
            { name: "Coca-Cola Zero (33cl)", category: "boissons", icon: "ü•§", points: 0 },
            { name: "Pepsi (33cl)", category: "boissons", icon: "ü•§", points: 4 },
            { name: "Sprite (33cl)", category: "boissons", icon: "ü•§", points: 4 },
            { name: "Fanta (33cl)", category: "boissons", icon: "ü•§", points: 4 },
            { name: "Ice Tea (33cl)", category: "boissons", icon: "ü•§", points: 3 },
            { name: "Red Bull (25cl)", category: "boissons", icon: "ü•§", points: 4 },
            { name: "Monster Energy (50cl)", category: "boissons", icon: "ü•§", points: 7 },
            { name: "Jus d'orange (25cl)", category: "boissons", icon: "üßÉ", points: 4 },
            { name: "Jus de pomme (25cl)", category: "boissons", icon: "üßÉ", points: 3 },
            { name: "Jus de raisin (25cl)", category: "boissons", icon: "üßÉ", points: 4 },
            { name: "Jus de pamplemousse (25cl)", category: "boissons", icon: "üßÉ", points: 3 },
            { name: "Jus de cranberry (25cl)", category: "boissons", icon: "üßÉ", points: 3 },
            { name: "Smoothie banane (25cl)", category: "boissons", icon: "ü•§", points: 5 },
            { name: "Smoothie fruits rouges (25cl)", category: "boissons", icon: "ü•§", points: 5 },
            { name: "Smoothie vert (25cl)", category: "boissons", icon: "ü•§", points: 3 },
            { name: "Lait de coco (25cl)", category: "boissons", icon: "ü••", points: 5 },
            { name: "Lait d'amande (25cl)", category: "boissons", icon: "ü•õ", points: 1 },
            { name: "Lait de soja (25cl)", category: "boissons", icon: "ü•õ", points: 2 },
            { name: "Lait d'avoine (25cl)", category: "boissons", icon: "ü•õ", points: 3 },
            { name: "Kombucha (25cl)", category: "boissons", icon: "üçµ", points: 1 },
            { name: "Starbucks Frappuccino", category: "boissons", icon: "‚òï", points: 12 },
            { name: "Starbucks Latte Grande", category: "boissons", icon: "‚òï", points: 6 },
            { name: "Starbucks Caramel Macchiato", category: "boissons", icon: "‚òï", points: 8 },
            
            // Alcools
            { name: "Vin rouge (15cl)", category: "boissons", icon: "üç∑", points: 3 },
            { name: "Vin blanc (15cl)", category: "boissons", icon: "üç∑", points: 3 },
            { name: "Vin ros√© (15cl)", category: "boissons", icon: "üç∑", points: 3 },
            { name: "Champagne (15cl)", category: "boissons", icon: "üçæ", points: 3 },
            { name: "Prosecco (15cl)", category: "boissons", icon: "üçæ", points: 3 },
            { name: "Bi√®re blonde (25cl)", category: "boissons", icon: "üç∫", points: 4 },
            { name: "Bi√®re brune (25cl)", category: "boissons", icon: "üç∫", points: 4 },
            { name: "Bi√®re blanche (25cl)", category: "boissons", icon: "üç∫", points: 4 },
            { name: "Bi√®re sans alcool (25cl)", category: "boissons", icon: "üç∫", points: 2 },
            { name: "Cidre (25cl)", category: "boissons", icon: "üç∫", points: 3 },
            { name: "Whisky (4cl)", category: "boissons", icon: "ü•É", points: 2 },
            { name: "Vodka (4cl)", category: "boissons", icon: "ü•É", points: 2 },
            { name: "Rhum (4cl)", category: "boissons", icon: "ü•É", points: 2 },
            { name: "Gin (4cl)", category: "boissons", icon: "ü•É", points: 2 },
            { name: "Tequila (4cl)", category: "boissons", icon: "ü•É", points: 2 },
            { name: "Cognac (4cl)", category: "boissons", icon: "ü•É", points: 2 },
            { name: "Armagnac (4cl)", category: "boissons", icon: "ü•É", points: 2 },
            { name: "Pastis/Ricard (4cl)", category: "boissons", icon: "ü•É", points: 2 },
            { name: "Get 27 (4cl)", category: "boissons", icon: "ü•É", points: 3 },
            { name: "Baileys (4cl)", category: "boissons", icon: "ü•É", points: 4 },
            { name: "Amaretto (4cl)", category: "boissons", icon: "ü•É", points: 3 },
            { name: "Limoncello (4cl)", category: "boissons", icon: "ü•É", points: 3 },
            
            // Cocktails
            { name: "Mojito", category: "boissons", icon: "üçπ", points: 5 },
            { name: "Virgin Mojito", category: "boissons", icon: "üçπ", points: 3 },
            { name: "Pi√±a Colada", category: "boissons", icon: "üçπ", points: 8 },
            { name: "Daiquiri", category: "boissons", icon: "üçπ", points: 4 },
            { name: "Margarita", category: "boissons", icon: "üçπ", points: 5 },
            { name: "Cosmopolitan", category: "boissons", icon: "üçπ", points: 4 },
            { name: "Sex on the Beach", category: "boissons", icon: "üçπ", points: 6 },
            { name: "Long Island Iced Tea", category: "boissons", icon: "üçπ", points: 7 },
            { name: "Bloody Mary", category: "boissons", icon: "üçπ", points: 3 },
            { name: "Moscow Mule", category: "boissons", icon: "üçπ", points: 4 },
            { name: "Caipirinha", category: "boissons", icon: "üçπ", points: 5 },
            { name: "Gin Tonic", category: "boissons", icon: "üçπ", points: 3 },
            { name: "Whisky Coca", category: "boissons", icon: "üçπ", points: 5 },
            { name: "Vodka Orange", category: "boissons", icon: "üçπ", points: 4 },
            { name: "Kir", category: "boissons", icon: "üçπ", points: 3 },
            { name: "Kir Royal", category: "boissons", icon: "üçπ", points: 4 },
            { name: "Sangria (20cl)", category: "boisons", icon: "üçπ", points: 5 },
            { name: "Punch (20cl)", category: "boissons", icon: "üçπ", points: 6 },
            { name: "Ti Punch", category: "boissons", icon: "üçπ", points: 4 },

		// Bonbons et confiseries
            { name: "Haribo Tagada (10 pi√®ces)", category: "plaisir", icon: "üç¨", points: 4 },
            { name: "Haribo Ours d'Or (10 pi√®ces)", category: "plaisir", icon: "üêª", points: 3 },
            { name: "Haribo Dragibus (30g)", category: "plaisir", icon: "üç¨", points: 3 },
            { name: "Haribo Croco (6 pi√®ces)", category: "plaisir", icon: "üêä", points: 4 },
            { name: "Lutti Ours (10 pi√®ces)", category: "plaisir", icon: "üêª", points: 3 },
            { name: "Carambar (1 pi√®ce)", category: "plaisir", icon: "üç¨", points: 1 },
            { name: "Krema (1 pi√®ce)", category: "plaisir", icon: "üç¨", points: 1 },
            { name: "Malabar (1 chewing-gum)", category: "plaisir", icon: "üç¨", points: 1 },
            { name: "Mentos (1 rouleau)", category: "plaisir", icon: "üç¨", points: 4 },
            { name: "Tic Tac (1 bo√Æte)", category: "plaisir", icon: "üç¨", points: 2 },
            { name: "Ricola (5 pastilles)", category: "plaisir", icon: "üç¨", points: 1 },
            { name: "Fisherman's Friend (5 pastilles)", category: "plaisir", icon: "üç¨", points: 1 },
            { name: "Bonbons Werther's (5 pi√®ces)", category: "plaisir", icon: "üç¨", points: 3 },
            { name: "Bonbons Violette Toulouse (10 pi√®ces)", category: "plaisir", icon: "üç¨", points: 3 },
            { name: "Cachou Lajaunie (1 bo√Æte)", category: "plaisir", icon: "üç¨", points: 2 },
            { name: "Anis de Flavigny (10 pi√®ces)", category: "plaisir", icon: "üç¨", points: 2 },
            { name: "Drag√©es (20g)", category: "plaisir", icon: "üç¨", points: 3 },
            { name: "Berlingots (5 pi√®ces)", category: "plaisir", icon: "üç¨", points: 3 },
            { name: "Sucettes Chupa Chups (2 pi√®ces)", category: "plaisir", icon: "üç≠", points: 2 },
            { name: "Bonbons Hollywood (1 paquet)", category: "plaisir", icon: "üç¨", points: 2 },
            { name: "R√©glisse Zan (10 pi√®ces)", category: "plaisir", icon: "üñ§", points: 2 },
            { name: "Nounours Guimauve (5 pi√®ces)", category: "plaisir", icon: "üêª", points: 3 },
            { name: "Chamallows (5 pi√®ces)", category: "plaisir", icon: "‚òÅÔ∏è", points: 2 },
            { name: "Fraises Tagada Haribo (8 pi√®ces)", category: "plaisir", icon: "üçì", points: 4 },
            { name: "Coca Haribo (10 pi√®ces)", category: "plaisir", icon: "ü•§", points: 3 },
            { name: "Schtroumpfs Haribo (12 pi√®ces)", category: "plaisir", icon: "üîµ", points: 3 },
            { name: "Bonbons sans sucre (10 pi√®ces)", category: "plaisir", icon: "üç¨", points: 1 },
            { name: "Smarties (1 tube)", category: "plaisir", icon: "üç¨", points: 4 },
            { name: "M&M's (45g)", category: "plaisir", icon: "üç´", points: 6 },
            { name: "Skittles (45g)", category: "plaisir", icon: "üç¨", points: 5 },
            { name: "Bounty (1 barre)", category: "plaisir", icon: "üç´", points: 6 },
            { name: "Mars (1 barre)", category: "plaisir", icon: "üç´", points: 6 },
            { name: "Snickers (1 barre)", category: "plaisir", icon: "üç´", points: 7 },
            { name: "Twix (2 barres)", category: "plaisir", icon: "üç´", points: 6 },
            { name: "KitKat (4 doigts)", category: "plaisir", icon: "üç´", points: 5 },
            { name: "Lion (1 barre)", category: "plaisir", icon: "üç´", points: 7 },
            { name: "Toblerone (3 triangles)", category: "plaisir", icon: "üç´", points: 4 },
     ];
        // Initialize app
        document.addEventListener('DOMContentLoaded', function() {
            loadData();
            renderFoodGrid();
            updateDisplay();
            loadProfileData();
            updateHistoryDisplay();
            updateWeeklyPointsDisplay();
        });

        // Tab management
        function showTab(tabName) {
            // Hide all tab contents
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // Remove active class from all nav tabs
            document.querySelectorAll('.nav-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // Show selected tab
            document.getElementById(tabName).classList.add('active');
            event.target.classList.add('active');
            
            // Update history when history tab is shown
            if (tabName === 'history') {
                updateHistoryDisplay();
            }
        }

        // Data persistence functions
        function saveData() {
            const today = new Date();
            const todayKey = getDateKey(today);
            
            // Check for weekly reset BEFORE saving
            checkWeeklyReset();
            
            // Calculate remaining points for today
            const dailyPoints = userData.dailyPoints || 25;
            const totalConsumed = consumedFoods.reduce((sum, food) => sum + food.totalPoints, 0);
            const totalActivity = activities.reduce((sum, activity) => sum + activity.points, 0);
            const totalAvailable = dailyPoints + totalActivity + usedWeeklyPoints;
            const remaining = Math.max(0, totalAvailable - totalConsumed);
            
            // Save today's data to history (CORRECTION: Always preserve daily data)
            historyData[todayKey] = {
                consumedFoods: [...consumedFoods],
                activities: [...activities],
                totalCalories: totalCalories,
                totalSteps: totalSteps,
                dailyPoints: userData.dailyPoints || 25,
                usedWeeklyPoints: usedWeeklyPoints,
                savedPoints: remaining,
                lastSaved: new Date().toISOString()
            };
            
            const data = {
                userData,
                consumedFoods,
                activities,
                totalCalories,
                totalSteps,
                historyData, // CORRECTION: Always preserve complete history
                weeklyExtraPoints,
                currentWeekKey,
                usedWeeklyPoints,
                lastSaved: new Date().toISOString()
            };
            
            try {
                localStorage.setItem(STORAGE_KEY, JSON.stringify(data));
                // Create backup
                localStorage.setItem(BACKUP_KEY, JSON.stringify(data));
                console.log('‚úÖ Data saved successfully to localStorage');
            } catch (error) {
                console.error('‚ùå Error saving data:', error);
                showToast('‚ö†Ô∏è Erreur lors de la sauvegarde');
            }
        }

        function loadData() {
            try {
                const dataString = localStorage.getItem(STORAGE_KEY);
                const data = dataString ? JSON.parse(dataString) : null;
                
                if (data) {
                    userData = data.userData || {};
                    historyData = data.historyData || {}; // CORRECTION: Load complete history
                    weeklyExtraPoints = data.weeklyExtraPoints || 0;
                    currentWeekKey = data.currentWeekKey || getCurrentWeekKey();
                    
                    // Check if data is from today
                    const today = new Date().toDateString();
                    const lastSaved = data.lastSaved ? new Date(data.lastSaved).toDateString() : null;
                    
                    if (lastSaved !== today) {
    // Nouveau jour -> vider seulement la journ√©e courante
    consumedFoods = [];
    activities = [];
    totalCalories = 0;
    totalSteps = 0;
    usedWeeklyPoints = 0;
    console.log('üåÖ Nouveau jour d√©tect√© : donn√©es du jour r√©initialis√©es, historique pr√©serv√©');
    showToast('üåÖ Nouveau jour d√©tect√© !');
                    } else {
                        // Same day - load saved daily data
                        consumedFoods = data.consumedFoods || [];
                        activities = data.activities || [];
                        totalCalories = data.totalCalories || 0;
                        totalSteps = data.totalSteps || 0;
                        usedWeeklyPoints = data.usedWeeklyPoints || 0;
                    }
                    
                    // Check for weekly reset
                    checkWeeklyReset();
                    console.log('‚úÖ Data loaded successfully from localStorage');
                } else {
                    initializeDefaultData();
                    console.log('üÜï No saved data found, using defaults');
                }
            } catch (error) {
                console.error('‚ùå Error loading data:', error);
                // Try to load from backup
                try {
                    const backupString = localStorage.getItem(BACKUP_KEY);
                    if (backupString) {
                        const backupData = JSON.parse(backupString);
                        console.log('üîÑ Loaded from backup');
                        showToast('üîÑ Donn√©es restaur√©es depuis la sauvegarde');
                        
                        // Process backup data same as above
                        userData = backupData.userData || {};
                        historyData = backupData.historyData || {}; // CORRECTION: Preserve history from backup
                        weeklyExtraPoints = backupData.weeklyExtraPoints || 0;
                        currentWeekKey = backupData.currentWeekKey || getCurrentWeekKey();
                        
                        // Same day check for backup
                        const today = new Date().toDateString();
                        const lastSaved = backupData.lastSaved ? new Date(backupData.lastSaved).toDateString() : null;
                        
                        if (lastSaved !== today) {
                            consumedFoods = [];
                            activities = [];
                            totalCalories = 0;
                            totalSteps = 0;
                            usedWeeklyPoints = 0;
                        } else {
                            consumedFoods = backupData.consumedFoods || [];
                            activities = backupData.activities || [];
                            totalCalories = backupData.totalCalories || 0;
                            totalSteps = backupData.totalSteps || 0;
                            usedWeeklyPoints = backupData.usedWeeklyPoints || 0;
                        }
                        
                        checkWeeklyReset();
                    } else {
                        initializeDefaultData();
                    }
                } catch (backupError) {
                    console.error('‚ùå Error loading backup:', backupError);
                    initializeDefaultData();
                    showToast('‚ö†Ô∏è Erreur de chargement, donn√©es r√©initialis√©es');
                }
            }
        }

       function exportData() {
            try {
                const data = {
                    userData,
                    consumedFoods,
                    activities,
                    totalCalories,
                    totalSteps,
                    historyData,
                    weeklyExtraPoints,
                    currentWeekKey,
                    usedWeeklyPoints,
                    exportDate: new Date().toISOString(),
                    version: "2.0"
                };
                
                const dataStr = JSON.stringify(data, null, 2);
                
                const isIOS = /iPad|iPhone|iPod/.test(navigator.userAgent) && !window.MSStream;
                const isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
                
                if (isIOS || isMobile) {
                    if (navigator.clipboard && navigator.clipboard.writeText) {
                        navigator.clipboard.writeText(dataStr).then(() => {
                            showToast('üìã Donn√©es copi√©es !');
                            alert('‚úÖ Donn√©es export√©es !\n\nCollez-les dans un fichier texte.');
                        }).catch(() => {
                            showExportModal(dataStr);
                        });
                    } else {
                        showExportModal(dataStr);
                    }
                } else {
                    const dataBlob = new Blob([dataStr], {type: 'application/json'});
                    const url = URL.createObjectURL(dataBlob);
                    
                    const link = document.createElement('a');
                    link.href = url;
                    link.download = `antomani-weight-${new Date().toISOString().split('T')[0]}.json`;
                    document.body.appendChild(link);
                    link.click();
                    document.body.removeChild(link);
                    
                    URL.revokeObjectURL(url);
                    showToast('üì§ Donn√©es export√©es !');
                }
            } catch (error) {
                console.error('Export error:', error);
                showToast('‚ùå Erreur export');
            }
        }

        function importData() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = '.json';
            input.onchange = function(event) {
                const file = event.target.files[0];
                if (!file) return;
                
                const reader = new FileReader();
                reader.onload = function(e) {
                    try {
                        const data = JSON.parse(e.target.result);
                        
                        // Validate imported data
                        if (data && typeof data === 'object') {
                            userData = data.userData || userData;
                            historyData = data.historyData || {}; // CORRECTION: Import complete history
                            weeklyExtraPoints = data.weeklyExtraPoints || 0;
                            currentWeekKey = data.currentWeekKey || getCurrentWeekKey();
                            
                            // CORRECTION: Smart import - preserve current day data if different
                            const today = new Date().toDateString();
                            const importDate = data.exportDate ? new Date(data.exportDate).toDateString() : null;
                            
                            if (importDate === today) {
                                // Same day import - restore daily data
                                consumedFoods = data.consumedFoods || [];
                                activities = data.activities || [];
                                totalCalories = data.totalCalories || 0;
                                totalSteps = data.totalSteps || 0;
                                usedWeeklyPoints = data.usedWeeklyPoints || 0;
                            } else {
                                // Different day - keep current daily data
                                showToast('Historique importe, donn√©es du jour conserv√©es');
                            }
                            
                            // Update displays
                            loadProfileData();
                            updateDisplay();
                            renderFoodGrid();
                            updateHistoryDisplay();
                            updateWeeklyPointsDisplay();
                            
                            // Save imported data
                            saveData();
                            
                            showToast('üì• Donn√©es import√©es avec succ√®s !');
                        } else {
                            showToast('‚ùå Fichier invalide');
                        }
                    } catch (error) {
                        console.error('‚ùå Import error:', error);
                        showToast('‚ùå Erreur lors de l\'import');
                    }
                };
                reader.readAsText(file);
            };
            input.click();
        }


        // Weekly Points Management

        function getCurrentWeekKey() {
    const now = new Date();
    const monday = new Date(now);
    const dayOfWeek = now.getDay();
    const daysFromMonday = dayOfWeek === 0 ? 6 : dayOfWeek - 1;
    monday.setDate(now.getDate() - daysFromMonday);
    monday.setHours(0, 0, 0, 0); // ‚úÖ AJOUT : R√©initialiser l'heure
    return monday.toISOString().split('T')[0];
}

        function getNextMondayDate() {
            const now = new Date();
            const monday = new Date(now);
            const dayOfWeek = now.getDay();
            const daysUntilMonday = dayOfWeek === 0 ? 1 : 8 - dayOfWeek;
            monday.setDate(now.getDate() + daysUntilMonday);
            return monday.toLocaleDateString('fr-FR');
        }

        function checkWeeklyReset() {
    const newWeekKey = getCurrentWeekKey();
    
    // ‚úÖ Ne reset que si c'est vraiment une nouvelle semaine (lundi)
    if (currentWeekKey && currentWeekKey !== newWeekKey) {
        const oldWeekDate = new Date(currentWeekKey);
        const newWeekDate = new Date(newWeekKey);
        
        // V√©rifier qu'au moins 7 jours se sont √©coul√©s
        const daysDiff = Math.floor((newWeekDate - oldWeekDate) / (1000 * 60 * 60 * 24));
        
        if (daysDiff >= 7) {
            weeklyExtraPoints = 0;
            showToast('üìÖ Nouvelle semaine ! Points √©carts remis √† z√©ro.');
            console.log('Weekly reset: extra points reset, history preserved');
        }
    }
    currentWeekKey = newWeekKey;
}

        function saveRemainingPoints() {
    const dailyPoints = userData.dailyPoints || 25;
    const totalConsumed = consumedFoods.reduce((sum, food) => sum + food.totalPoints, 0);
    const totalActivity = activities.reduce((sum, activity) => sum + activity.points, 0);
    const totalAvailable = dailyPoints + totalActivity + usedWeeklyPoints;
    const remaining = totalAvailable - totalConsumed;
    
    if (remaining <= 0) {
        showToast('‚ùå Aucun point restant √† √©conomiser !');
        return;
    }
    
    weeklyExtraPoints += remaining;
    
    // ‚úÖ Ajout dans l‚Äôhistorique du jour
    const todayKey = getDateKey(new Date());
    if (!historyData[todayKey]) {
        historyData[todayKey] = {
            consumedFoods: [],
            activities: [],
            totalCalories: 0,
            totalSteps: 0,
            dailyPoints: userData.dailyPoints || 25,
            usedWeeklyPoints: 0,
            savedPoints: 0,
            lastSaved: new Date().toISOString()
        };
    }
    historyData[todayKey].savedPoints = (historyData[todayKey].savedPoints || 0) + remaining;

    showToast(`üí∞ ${remaining} points √©conomis√©s pour les √©carts ! Total: ${weeklyExtraPoints}`);
    updateWeeklyPointsDisplay();
    saveData();
}
        function useWeeklyPoints() {
            if (weeklyExtraPoints <= 0) {
                showToast('‚ùå Aucun point √©cart disponible !');
                return;
            }
            
            const pointsToUse = prompt(`Combien de points √©carts voulez-vous utiliser ? (Disponibles: ${weeklyExtraPoints})`);
            const points = parseInt(pointsToUse);
            
            if (isNaN(points) || points <= 0) {
                showToast('‚ùå Nombre de points invalide !');
                return;
            }
            
            if (points > weeklyExtraPoints) {
                showToast('‚ùå Pas assez de points √©carts disponibles !');
                return;
            }
            
            weeklyExtraPoints -= points;
            usedWeeklyPoints += points;
            
            updateDisplay();
            updateWeeklyPointsDisplay();
            saveData();
            showToast(`üçï ${points} points √©carts ajout√©s ! Restants: ${weeklyExtraPoints}`);
        }

        function updateWeeklyPointsDisplay() {
            document.getElementById('weeklyPointsDisplay').textContent = weeklyExtraPoints;
            document.getElementById('nextResetDate').textContent = getNextMondayDate();
        }

        // Profile management
        function toggleCalculationMode(mode) {
            document.getElementById('autoMode').classList.toggle('active', mode === 'auto');
            document.getElementById('manualMode').classList.toggle('active', mode === 'manual');
            document.getElementById('autoModeForm').style.display = mode === 'auto' ? 'block' : 'none';
            document.getElementById('manualModeForm').style.display = mode === 'manual' ? 'block' : 'none';
            
            userData.calculationMode = mode;
            saveData();
        }

        function calculatePoints() {
            const name = document.getElementById('userName').value;
            const age = parseInt(document.getElementById('userAge').value);
            const gender = document.getElementById('userGender').value;
            const height = parseInt(document.getElementById('userHeight').value);
            const weight = parseFloat(document.getElementById('currentWeight').value);
            const targetWeight = parseFloat(document.getElementById('targetWeight').value);
            const activityLevel = parseFloat(document.getElementById('activityLevel').value);
            const weightLossGoal = parseFloat(document.getElementById('weightLossGoal').value);

            if (!age || !gender || !height || !weight || !targetWeight || !activityLevel || !weightLossGoal) {
                document.getElementById('calculationResults').style.display = 'none';
                return;
            }

            let bmrCurrent;
            if (gender === 'male') {
                bmrCurrent = (10 * weight) + (6.25 * height) - (5 * age) + 5;
            } else {
                bmrCurrent = (10 * weight) + (6.25 * height) - (5 * age) - 161;
            }

            let bmrTarget;
            if (gender === 'male') {
                bmrTarget = (10 * targetWeight) + (6.25 * height) - (5 * age) + 5;
            } else {
                bmrTarget = (10 * targetWeight) + (6.25 * height) - (5 * age) - 161;
            }

            const tdeeCurrent = bmrCurrent * activityLevel;
            const tdeeTarget = bmrTarget * activityLevel;
            
            const deficitPerWeek = weightLossGoal * 7700;
            const deficitPerDay = deficitPerWeek / 7;
            
            const targetCalories = tdeeTarget;
            const maxDeficit = tdeeCurrent * 0.25;
            const actualDeficit = Math.min(deficitPerDay, maxDeficit);
            const finalCalories = Math.max(targetCalories, tdeeCurrent - actualDeficit);
            
            const theoreticalPoints = Math.round(finalCalories / 80);

            let finalPoints;
            let genderRangeText = '';
            let adjustmentMade = false;

            if (gender === 'female') {
                finalPoints = Math.max(23, Math.min(30, theoreticalPoints));
                genderRangeText = 'Fourchette : 23-30 points/jour';
                if (theoreticalPoints < 23 || theoreticalPoints > 30) {
                    adjustmentMade = true;
                }
            } else {
                finalPoints = Math.max(30, Math.min(40, theoreticalPoints));
                genderRangeText = 'Fourchette : 30-40 points/jour';
                if (theoreticalPoints < 30 || theoreticalPoints > 40) {
                    adjustmentMade = true;
                }
            }

            const heightM = height / 100;
            const currentBMI = (weight / (heightM * heightM)).toFixed(1);
            const targetBMI = (targetWeight / (heightM * heightM)).toFixed(1);

            document.getElementById('bmrResult').textContent = Math.round(bmrCurrent) + ' kcal/jour';
            document.getElementById('tdeeResult').textContent = Math.round(tdeeCurrent) + ' kcal/jour';
            document.getElementById('deficitResult').textContent = Math.round(actualDeficit) + ' kcal/jour';
            document.getElementById('targetCaloriesResult').textContent = Math.round(finalCalories) + ' kcal/jour';
            document.getElementById('finalPoints').textContent = finalPoints;

            let explanation = `Bas√© sur objectif de ${weightLossGoal}kg/semaine. `;
            explanation += `Calcul pour m√©tabolisme √† ${targetWeight}kg.`;
            if (adjustmentMade) {
                explanation += ` Ajust√© aux limites saines.`;
            }
            document.getElementById('calculationExplanation').textContent = explanation;

            const genderRangeInfo = document.getElementById('genderRangeInfo');
            const genderRangeTextDiv = document.getElementById('genderRangeText');
            if (adjustmentMade) {
                genderRangeTextDiv.innerHTML = `<strong>Ajustement :</strong><br>${genderRangeText}<br>Th√©orique : ${theoreticalPoints} ‚Üí Ajust√© : ${finalPoints} pts`;
                genderRangeInfo.style.display = 'block';
            } else {
                genderRangeTextDiv.textContent = genderRangeText;
                genderRangeInfo.style.display = 'block';
            }

            document.getElementById('calculationResults').style.display = 'block';
            document.getElementById('currentBMI').textContent = currentBMI;
            document.getElementById('targetBMI').textContent = targetBMI;
            document.getElementById('bmrDisplay').textContent = Math.round(bmrTarget) + ' (cible)';
            document.getElementById('calculatedPoints').textContent = finalPoints;

            userData.profile = {
                name, age, gender, height, weight, targetWeight, 
                activityLevel, weightLossGoal, 
                bmr: bmrCurrent, 
                bmrTarget: bmrTarget,
                tdee: tdeeCurrent, 
                dailyPoints: finalPoints, 
                theoreticalPoints, 
                adjustmentMade,
                targetCalories: finalCalories
            };
            userData.dailyPoints = finalPoints;
            
            updateProfileStatus();
            saveData();
        }


        function updateManualPoints() {
            const points = parseInt(document.getElementById('manualPoints').value);
            if (points && points >= 20 && points <= 50) {
                userData.dailyPoints = points;
                saveData();
            }
        }

        function updateProfileStatus() {
            const profileStatus = document.getElementById('profileStatus');
            const profileTitle = document.getElementById('profileTitle');
            const profileSubtitle = document.getElementById('profileSubtitle');
            const profileStats = document.getElementById('profileStats');

            if (userData.profile && userData.dailyPoints) {
                profileStatus.classList.add('profile-complete');
                profileTitle.textContent = `üëã Bonjour ${userData.profile.name || 'Utilisateur'}`;
                profileSubtitle.textContent = `Profil configur√© - ${userData.dailyPoints} points/jour`;
                profileStats.style.display = 'block';
            }
        }

        function saveProfile() {
            const mode = userData.calculationMode || 'auto';
            
            if (mode === 'auto') {
                const name = document.getElementById('userName').value;
                const age = parseInt(document.getElementById('userAge').value);
                const gender = document.getElementById('userGender').value;
                const height = parseInt(document.getElementById('userHeight').value);
                const weight = parseFloat(document.getElementById('currentWeight').value);
                const targetWeight = parseFloat(document.getElementById('targetWeight').value);
                const activityLevel = parseFloat(document.getElementById('activityLevel').value);
                const weightLossGoal = parseFloat(document.getElementById('weightLossGoal').value);
                
                if (!name || !age || !gender || !height || !weight || !targetWeight || !activityLevel || !weightLossGoal) {
                    showToast('‚ö†Ô∏è Remplir tous les champs');
                    return;
                }
                
                if (!userData.profile || !userData.dailyPoints) {
                    showToast('‚ö†Ô∏è Calculs non effectu√©s');
                    return;
                }
                
                saveData();
                updateDisplay();
                showToast('‚úÖ Profil sauvegard√© !');
                updateProfileStatus();
                
            } else if (mode === 'manual') {
                const manualPoints = parseInt(document.getElementById('manualPoints').value);
                
                if (!manualPoints || manualPoints < 20 || manualPoints > 50) {
                    showToast('‚ö†Ô∏è Points 20-50');
                    return;
                }
                
                userData.dailyPoints = manualPoints;
                userData.calculationMode = 'manual';
                saveData();
                updateDisplay();
                showToast('‚úÖ Profil sauvegard√© !');
                updateProfileStatus();
            } else {
                showToast('‚ö†Ô∏è Choisir un mode');
            }
        }

        function loadProfileData() {
            if (userData.calculationMode === 'manual') {
                toggleCalculationMode('manual');
                document.getElementById('manualPoints').value = userData.dailyPoints || '';
            }
            
            if (userData.profile) {
                const p = userData.profile;
                document.getElementById('userName').value = p.name || '';
                document.getElementById('userAge').value = p.age || '';
                document.getElementById('userGender').value = p.gender || '';
                document.getElementById('userHeight').value = p.height || '';
                document.getElementById('currentWeight').value = p.weight || '';
                document.getElementById('targetWeight').value = p.targetWeight || '';
                document.getElementById('activityLevel').value = p.activityLevel || '';
                document.getElementById('weightLossGoal').value = p.weightLossGoal || '';
                
                calculatePoints();
            }
        }

        // Food management
        function renderFoodGrid() {
        const foodGrid = document.getElementById('foodGrid');
         const searchTerm = document.getElementById('foodSearch').value.toLowerCase();
    
        let filteredFoods = foodDatabase.filter(food => {
        const matchesSearch = food.name.toLowerCase().includes(searchTerm);
        const matchesCategory = currentCategory === 'all' || food.category === currentCategory;
        return matchesSearch && matchesCategory;
        });

        foodGrid.innerHTML = filteredFoods.map(food => {
        let pointsClass = 'food-points';
        if (food.points === 0) {
            pointsClass += ' points-zero';
        } else if (food.points >=10) {
            pointsClass += ' points-high';
        }

        return `
            <div class="food-item">
                <div class="food-icon">${food.icon}</div>
                <div class="food-info">
                    <div class="food-name">${food.name}</div>
                    <div class="food-category">${food.category}</div>
                </div>
                <div class="${pointsClass}">${food.points} pts</div>
                <button class="btn btn-add" onclick="showPortionModal('${food.name.replace(/'/g, "\\'")}', ${food.points}, '${food.icon}')">+</button>
            </div>
        `;
        }).join('');
        }

        function filterFoods() {
            renderFoodGrid();
        }

        function filterByCategory(category) {
            currentCategory = category;
            
            // Update active button
            document.querySelectorAll('.category-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            
            renderFoodGrid();
        }

        function addFood(name, points, icon) {
            const existingFood = consumedFoods.find(food => food.name === name);
            
            if (existingFood) {
                existingFood.quantity += 1;
                existingFood.totalPoints = existingFood.quantity * existingFood.points;
            } else {
                consumedFoods.push({
                    name: name,
                    points: points,
                    quantity: 1,
                    totalPoints: points,
                    time: new Date().toLocaleTimeString('fr-FR', { hour: '2-digit', minute: '2-digit' }),
                    icon: icon || 'üçΩÔ∏è'
                });
            }
            
            updateDisplay();
            saveData();
            showToast(`‚úÖ Ajout√©: ${name} (+${points} pts)`);
        }

function showPortionModal(name, points, icon) {
    const modal = document.createElement('div');
    modal.style.cssText = 'position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); z-index: 10000; display: flex; align-items: center; justify-content: center; padding: 20px; overflow-y: auto;';
    
    modal.innerHTML = `
        <div style="background: white; border-radius: 12px; padding: 20px; max-width: 400px; width: 100%; max-height: 90vh; overflow-y: auto;">
            <h3 style="margin-bottom: 10px; font-size: 1.1rem;">${name}</h3>
            <p style="margin-bottom: 15px; font-size: 0.85rem; color: #636e72;">Points de base : <strong>${points} pts</strong></p>
            
            <div style="margin-bottom: 15px;">
                <label style="display: block; margin-bottom: 8px; font-weight: 500; font-size: 0.9rem;">Quantit√© :</label>
                <div style="display: flex; align-items: center; gap: 8px;">
    
                    <input type="number" id="portionQuantity" value="1" min="0.1" step="0.1" style="width: 100%; height: 50px; padding: 0 15px; border: 2px solid #e9ecef; border-radius: 8px; font-size: 1.3rem; text-align: center; font-weight: bold;">
                </div>
                <small style="color: #636e72; font-size: 0.75rem; display: block; margin-top: 5px;">
                    0.5 = demi-portion, 2 = double portion
                </small>
            </div>
            
            <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); padding: 15px; border-radius: 8px; margin-bottom: 15px; text-align: center; color: white;">
                <div style="font-size: 0.8rem; opacity: 0.9;">Total des points :</div>
                <div style="font-size: 2rem; font-weight: bold; margin-top: 5px;" id="portionTotalPoints">${points}</div>
            </div>
            
            <div style="display: flex; gap: 8px;">
                <button onclick="addFoodWithPortion('${name.replace(/'/g, "\\'")}', ${points}, '${icon}')" style="flex: 1; padding: 14px; background: #667eea; color: white; border: none; border-radius: 8px; font-weight: 600; font-size: 0.95rem;">‚úÖ Ajouter</button>
                <button onclick="closePortionModal()" style="flex: 1; padding: 14px; background: #e9ecef; color: #2d3436; border: none; border-radius: 8px; font-weight: 600; font-size: 0.95rem;">Annuler</button>
            </div>
        </div>
    `;
    
    modal.id = 'portionModal';
    document.body.appendChild(modal);
    
    // Prevent body scroll when modal is open
    document.body.style.overflow = 'hidden';
    
    document.getElementById('portionQuantity').addEventListener('input', function() {
        updatePortionTotal(points);
    });
}

function updatePortionTotal(basePoints) {
    const quantity = parseFloat(document.getElementById('portionQuantity').value) || 1;
    const total = Math.round(basePoints * quantity * 10) / 10;
    document.getElementById('portionTotalPoints').textContent = total;
}

function addFoodWithPortion(name, basePoints, icon) {
    const quantity = parseFloat(document.getElementById('portionQuantity').value) || 1;
    const totalPoints = Math.round(basePoints * quantity * 10) / 10;
    
    closePortionModal();
    
    const displayName = quantity !== 1 ? `${name} (x${quantity})` : name;
    
    consumedFoods.push({
        name: displayName,
        points: totalPoints,
        quantity: 1,
        totalPoints: totalPoints,
        time: new Date().toLocaleTimeString('fr-FR', { hour: '2-digit', minute: '2-digit' }),
        icon: icon || 'üçΩÔ∏è'
    });
    
    updateDisplay();
    saveData();
    showToast(`‚úÖ ${displayName} - ${totalPoints} pts`);
}

function closePortionModal() {
    const modal = document.getElementById('portionModal');
    if (modal) {
        modal.remove();
        document.body.style.overflow = ''; // Restore body scroll
    }
}

function showCustomFoodModal() {
    const modal = document.createElement('div');
    modal.style.cssText = 'position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); z-index: 10000; display: flex; align-items: center; justify-content: center; padding: 20px; overflow-y: auto;';
    
    modal.innerHTML = `
        <div style="background: white; border-radius: 12px; padding: 20px; max-width: 400px; width: 100%; max-height: 90vh; overflow-y: auto;">
            <h3 style="margin-bottom: 15px; font-size: 1.1rem;">‚ûï Aliment personnalis√©</h3>
            
            <div style="margin-bottom: 15px;">
                <label style="display: block; margin-bottom: 5px; font-weight: 500; font-size: 0.9rem;">Nom de l'aliment :</label>
                <input type="text" id="customFoodName" placeholder="Ex: Sandwich maison" style="width: 100%; padding: 12px; border: 2px solid #e9ecef; border-radius: 8px; font-size: 1rem;">
            </div>
            
            <div style="margin-bottom: 15px;">
                <label style="display: block; margin-bottom: 5px; font-weight: 500; font-size: 0.9rem;">Nombre de points :</label>
                <input type="number" id="customFoodPoints" placeholder="Ex: 8" min="0" step="0.5" style="width: 100%; padding: 12px; border: 2px solid #e9ecef; border-radius: 8px; font-size: 1rem;">
                <small style="color: #636e72; font-size: 0.75rem; display: block; margin-top: 5px;">
                    üí° Astuce : 1 point ‚âà 80 calories
                </small>
            </div>
            
            <div style="margin-bottom: 15px;">
                <label style="display: block; margin-bottom: 5px; font-weight: 500; font-size: 0.9rem;">Emoji (optionnel) :</label>
                <input type="text" id="customFoodIcon" placeholder="üçΩÔ∏è" maxlength="2" style="width: 100%; padding: 12px; border: 2px solid #e9ecef; border-radius: 8px; font-size: 1.5rem; text-align: center;">
            </div>
            
            <div style="display: flex; gap: 8px;">
                <button onclick="addCustomFood()" style="flex: 1; padding: 14px; background: #667eea; color: white; border: none; border-radius: 8px; font-weight: 600; font-size: 0.95rem;">‚úÖ Ajouter</button>
                <button onclick="closeCustomFoodModal()" style="flex: 1; padding: 14px; background: #e9ecef; color: #2d3436; border: none; border-radius: 8px; font-weight: 600; font-size: 0.95rem;">Annuler</button>
            </div>
        </div>
    `;
    
    modal.id = 'customFoodModal';
    document.body.appendChild(modal);
    document.body.style.overflow = 'hidden';
}

function closeCustomFoodModal() {
    const modal = document.getElementById('customFoodModal');
    if (modal) {
        modal.remove();
        document.body.style.overflow = '';
    }
}

function addCustomFood() {
    const name = document.getElementById('customFoodName').value.trim();
    const points = parseFloat(document.getElementById('customFoodPoints').value);
    const icon = document.getElementById('customFoodIcon').value.trim() || 'üçΩÔ∏è';
    
    if (!name) {
        showToast('‚ö†Ô∏è Veuillez entrer un nom');
        return;
    }
    
    if (!points || points < 0) {
        showToast('‚ö†Ô∏è Veuillez entrer un nombre de points valide');
        return;
    }
    
    closeCustomFoodModal();
    
    consumedFoods.push({
        name: name,
        points: points,
        quantity: 1,
        totalPoints: points,
        time: new Date().toLocaleTimeString('fr-FR', { hour: '2-digit', minute: '2-digit' }),
        icon: icon
    });
    
    updateDisplay();
    saveData();
    showToast(`‚úÖ ${name} - ${points} pts`);
}

function closeCustomFoodModal() {
    const modal = document.getElementById('customFoodModal');
    if (modal) modal.remove();
}

        function removeFood(index) {
            const food = consumedFoods[index];
            if (food.quantity > 1) {
                food.quantity -= 1;
                food.totalPoints = food.quantity * food.points;
            } else {
                consumedFoods.splice(index, 1);
            }
            
            updateDisplay();
            saveData();
            showToast(`‚ùå Retir√©: ${food.name}`);
        }

        // Activity management
        function calculateCumulativeCaloriesPoints() {
            return Math.floor(totalCalories / 80);
        }
        
        function calculateCumulativeStepsPoints() {
            return Math.floor(totalSteps / 2000);
        }

        function updateCaloriesPoints() {
            const calories = parseInt(document.getElementById('caloriesInput').value) || 0;
            document.getElementById('caloriesPoints').textContent = Math.floor(calories / 80);
        }

        function updateStepsPoints() {
            const steps = parseInt(document.getElementById('stepsInput').value) || 0;
            document.getElementById('stepsPoints').textContent = Math.floor(steps / 2000);
        }

        function addCaloriesActivity() {
            const calories = parseInt(document.getElementById('caloriesInput').value);
            if (!calories || calories <= 0) {
                showToast('‚ö†Ô∏è Veuillez entrer un nombre de calories valide');
                return;
            }

            const pointsBefore = calculateCumulativeCaloriesPoints();
            totalCalories += calories;
            const pointsAfter = calculateCumulativeCaloriesPoints();
            const pointsGained = pointsAfter - pointsBefore;

            activities.push({
                type: 'calories',
                value: calories,
                points: pointsGained,
                time: new Date().toLocaleTimeString('fr-FR', { hour: '2-digit', minute: '2-digit' })
            });

            document.getElementById('caloriesInput').value = '';
            updateCaloriesPoints();
            updateCumulativeDisplays();
            updateActivityDisplay();
            updateDisplay();
            saveData();
            
            if (pointsGained > 0) {
                showToast(`üî• Activit√© ajout√©e: ${calories} calories (+${pointsGained} pts)`);
            } else {
                showToast(`üî• Calories ajout√©es: ${calories} (pas assez pour un point suppl√©mentaire)`);
            }
        }

        function addStepsActivity() {
            const steps = parseInt(document.getElementById('stepsInput').value);
            if (!steps || steps <= 0) {
                showToast('‚ö†Ô∏è Veuillez entrer un nombre de pas valide');
                return;
            }

            const pointsBefore = calculateCumulativeStepsPoints();
            totalSteps += steps;
            const pointsAfter = calculateCumulativeStepsPoints();
            const pointsGained = pointsAfter - pointsBefore;

            activities.push({
                type: 'steps',
                value: steps,
                points: pointsGained,
                time: new Date().toLocaleTimeString('fr-FR', { hour: '2-digit', minute: '2-digit' })
            });

            document.getElementById('stepsInput').value = '';
            updateStepsPoints();
            updateCumulativeDisplays();
            updateActivityDisplay();
            updateDisplay();
            saveData();
            
            if (pointsGained > 0) {
                showToast(`üö∂‚Äç‚ôÇÔ∏è Activit√© ajout√©e: ${steps.toLocaleString()} pas (+${pointsGained} pts)`);
            } else {
                showToast(`üö∂‚Äç‚ôÇÔ∏è Pas ajout√©s: ${steps.toLocaleString()} (pas assez pour un point suppl√©mentaire)`);
            }
        }

        function updateCumulativeDisplays() {
            const totalCaloriesPoints = calculateCumulativeCaloriesPoints();
            const totalStepsPointsCalc = calculateCumulativeStepsPoints();
            
            document.getElementById('totalCaloriesDisplay').textContent = totalCalories.toLocaleString();
            document.getElementById('totalCaloriesPoints').textContent = totalCaloriesPoints;
            document.getElementById('totalStepsDisplay').textContent = totalSteps.toLocaleString();
            document.getElementById('totalStepsPoints').textContent = totalStepsPointsCalc;
        }

        function removeActivity(index) {
            const activity = activities[index];
            
            if (activity.type === 'calories') {
                totalCalories -= activity.value;
            } else {
                totalSteps -= activity.value;
            }
            
            activities.splice(index, 1);
            recalculateAllActivityPoints();
            
            updateCumulativeDisplays();
            updateActivityDisplay();
            updateDisplay();
            saveData();
        }

        function recalculateAllActivityPoints() {
            let tempCalories = 0;
            let tempSteps = 0;
            
            activities.forEach(activity => {
                if (activity.type === 'calories') {
                    const pointsBefore = Math.floor(tempCalories / 80);
                    tempCalories += activity.value;
                    const pointsAfter = Math.floor(tempCalories / 80);
                    activity.points = pointsAfter - pointsBefore;
                } else {
                    const pointsBefore = Math.floor(tempSteps / 2000);
                    tempSteps += activity.value;
                    const pointsAfter = Math.floor(tempSteps / 2000);
                    activity.points = pointsAfter - pointsBefore;
                }
            });
        }

        function updateActivityDisplay() {
            const activitiesSection = document.getElementById('activitiesSection');
            const activitiesList = document.getElementById('activitiesList');
            
            if (activities.length === 0) {
                activitiesSection.style.display = 'none';
                return;
            }

            activitiesSection.style.display = 'block';
            activitiesList.innerHTML = activities.map((activity, index) => `
                <div class="consumed-item">
                    <div style="font-size: 1.2rem;">${activity.type === 'calories' ? 'üî•' : 'üö∂‚Äç‚ôÇÔ∏è'}</div>
                    <div style="flex: 1;">
                        <div style="font-weight: 600; font-size: 0.9rem;">
                            ${activity.type === 'calories' ? 
                                `${activity.value} calories` : 
                                `${activity.value.toLocaleString()} pas`
                            }
                        </div>
                        <div style="font-size: 0.75rem; color: #636e72;">${activity.time}</div>
                    </div>
                    <div style="font-weight: bold; color: #56ab2f; margin-right: 8px;">
                        ${activity.points > 0 ? `+${activity.points}` : '0'}
                    </div>
                    <button class="btn btn-remove" onclick="removeActivity(${index})">-</button>
                </div>
            `).join('');

            const totalActivityPoints = activities.reduce((sum, activity) => sum + activity.points, 0);
            document.getElementById('totalActivityPoints').textContent = totalActivityPoints;
        }

        // History management
        function getWeekDates(weekOffset = 0) {
            const today = new Date();
            const currentDay = today.getDay();
            const monday = new Date(today);
            
            monday.setDate(today.getDate() - currentDay + 1);
            monday.setDate(monday.getDate() + (weekOffset * 7));
            
            const dates = [];
            for (let i = 0; i < 7; i++) {
                const date = new Date(monday);
                date.setDate(monday.getDate() + i);
                dates.push(date);
            }
            
            return dates;
        }

        function getDateKey(date) {
            return date.toISOString().split('T')[0];
        }

        function changeWeek(direction) {
            currentWeekOffset += direction;
            updateHistoryDisplay();
        }

        function updateHistoryDisplay() {
            const weekDates = getWeekDates(currentWeekOffset);
            const today = new Date();
            const todayKey = getDateKey(today);
            
            const firstDay = weekDates[0];
            const lastDay = weekDates[6];
            const weekDisplay = document.getElementById('currentWeekDisplay');
            weekDisplay.textContent = `${firstDay.toLocaleDateString('fr-FR')} - ${lastDay.toLocaleDateString('fr-FR')}`;
            
            const dayCards = document.getElementById('dayCards');
            const dayNames = ['Lundi', 'Mardi', 'Mercredi', 'Jeudi', 'Vendredi', 'Samedi', 'Dimanche'];
            
            dayCards.innerHTML = weekDates.map((date, index) => {
                const dateKey = getDateKey(date);
                const isToday = dateKey === todayKey;
                const dayData = historyData[dateKey] || null;
                const hasData = dayData !== null;
                
                let totalConsumed = 0;
                let totalActivity = 0;
                let dailyPointsUsed = userData.dailyPoints || 25;
                let savedPoints = 0;
                let cheatPoints = 0;
                
                if (hasData) {
                    totalConsumed = dayData.consumedFoods?.reduce((sum, food) => sum + food.totalPoints, 0) || 0;
                    totalActivity = dayData.activities?.reduce((sum, activity) => sum + activity.points, 0) || 0;
                    dailyPointsUsed = dayData.dailyPoints || userData.dailyPoints || 25;
                    savedPoints = dayData.savedPoints || 0;
                    cheatPoints = dayData.usedWeeklyPoints || 0;
                }
                
                if (isToday) {
                    totalConsumed = consumedFoods.reduce((sum, food) => sum + food.totalPoints, 0);
                    totalActivity = activities.reduce((sum, activity) => sum + activity.points, 0);
                    dailyPointsUsed = userData.dailyPoints || 25;
                    savedPoints = 0;
                    cheatPoints = usedWeeklyPoints;
                }
                
                const totalAvailable = dailyPointsUsed + totalActivity + cheatPoints;
                const remaining = totalAvailable - totalConsumed;
                
                return `
                    <div class="day-card ${isToday ? 'today' : ''} ${!hasData && !isToday ? 'no-data' : ''}" 
                         onclick="toggleDayDetails('${dateKey}')">
                        <div class="day-header">
                            <div class="day-name">${dayNames[index]}</div>
                            <div class="day-date">${date.toLocaleDateString('fr-FR')}</div>
                        </div>
                        
                        <div class="day-summary">
                            <div class="summary-item">
                                <div class="summary-value">${totalConsumed}</div>
                                <div class="summary-label">Consomm√©</div>
                            </div>
                            <div class="summary-item">
                                <div class="summary-value">+${totalActivity}</div>
                                <div class="summary-label">Sport</div>
                            </div>
                            <div class="summary-item">
                                <div class="summary-value" style="color: ${remaining >= 0 ? '#56ab2f' : '#e53e3e'}">${remaining}</div>
                                <div class="summary-label">Restant</div>
                            </div>
                            <div class="summary-item">
                                <div class="summary-value" style="color: #f39c12">${cheatPoints}</div>
                                <div class="summary-label">√âcarts</div>
                            </div>
                        </div>
                        
                        ${hasData || isToday ? `
                            <div class="day-details" id="details-${dateKey}">
                                ${generateDayDetails(dateKey, isToday)}
                            </div>
                        ` : `
                            <div style="text-align: center; padding: 10px; color: #636e72; font-size: 0.8rem;">
                                Aucune donn√©e disponible
                            </div>
                        `}
                    </div>
                `;
            }).join('');
        }

        function generateDayDetails(dateKey, isToday) {
            let dayData;
            
            if (isToday) {
                dayData = {
                    consumedFoods: consumedFoods,
                    activities: activities,
                    dailyPoints: userData.dailyPoints || 25,
                    usedWeeklyPoints: usedWeeklyPoints
                };
            } else {
                dayData = historyData[dateKey];
            }
            
            if (!dayData) return '<div style="text-align: center; padding: 10px;">Aucune donn√©e</div>';
            
            let html = '';
            
            if (dayData.consumedFoods && dayData.consumedFoods.length > 0) {
                html += `
                    <div class="detail-section">
                        <div class="detail-title">üçΩÔ∏è Aliments consomm√©s</div>
                        <div class="detail-list">
                            ${dayData.consumedFoods.map(food => `
                                <div class="detail-item">
                                    <span>${food.icon || 'üçΩÔ∏è'} ${food.name} ${food.quantity > 1 ? `(x${food.quantity})` : ''}</span>
                                    <span>${food.totalPoints} pts</span>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                `;
            }
            
            if (dayData.activities && dayData.activities.length > 0) {
                html += `
                    <div class="detail-section">
                        <div class="detail-title">üèÉ‚Äç‚ôÇÔ∏è Activit√©s</div>
                        <div class="detail-list">
                            ${dayData.activities.map(activity => `
                                <div class="detail-item">
                                    <span>${activity.type === 'calories' ? 'üî•' : 'üö∂‚Äç‚ôÇÔ∏è'} ${activity.type === 'calories' ? 
                                        `${activity.value} calories` : 
                                        `${activity.value.toLocaleString()} pas`
                                    }</span>
                                    <span>+${activity.points} pts</span>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                `;
            }

            if (dayData.usedWeeklyPoints && dayData.usedWeeklyPoints > 0) {
                html += `
                    <div class="detail-section">
                        <div class="detail-title">üçï Points √©carts utilis√©s</div>
                        <div class="detail-list">
                            <div class="detail-item">
                                <span>Points √©carts bonus</span>
                                <span>+${dayData.usedWeeklyPoints} pts</span>
                            </div>
                        </div>
                    </div>
                `;
            }
            
            if (!html) {
                html = '<div style="text-align: center; padding: 10px; color: #636e72;">Aucune activit√© enregistr√©e</div>';
            }
            
            return html;
        }

        function toggleDayDetails(dateKey) {
            const details = document.getElementById(`details-${dateKey}`);
            if (details) {
                details.classList.toggle('expanded');
            }
        }

        // Display management
        function updateDisplay() {
            const dailyPoints = userData.dailyPoints || 25;
            const totalConsumed = consumedFoods.reduce((sum, food) => sum + food.totalPoints, 0);
            const totalActivity = activities.reduce((sum, activity) => sum + activity.points, 0);
            const totalAvailable = dailyPoints + totalActivity + usedWeeklyPoints;
            const remaining = totalAvailable - totalConsumed;
            const progressPercentage = Math.min((totalConsumed / totalAvailable) * 100, 100);

            document.getElementById('dailyPointsDisplay').textContent = `${totalConsumed} / ${totalAvailable}`;
            document.getElementById('remainingPointsDisplay').textContent = remaining;
            document.getElementById('basePointsDisplay').textContent = dailyPoints;
            document.getElementById('activityPointsDisplay').textContent = totalActivity;
            document.getElementById('cheatPointsDisplay').textContent = usedWeeklyPoints;
            document.getElementById('progressBar').style.width = `${progressPercentage}%`;

            updateConsumedFoodsDisplay();
            updateActivityDisplay();
            updateCumulativeDisplays();
        }

        function updateConsumedFoodsDisplay() {
            const consumedSection = document.getElementById('consumedSection');
            const consumedFoods_div = document.getElementById('consumedFoods');
            const totalPointsConsumed = document.getElementById('totalPointsConsumed');
            
            if (consumedFoods.length === 0) {
                consumedSection.style.display = 'none';
                return;
            }

            consumedSection.style.display = 'block';
            consumedFoods_div.innerHTML = consumedFoods.map((food, index) => `
                <div class="consumed-item">
                    <div style="font-size: 1.2rem;">${food.icon || 'üçΩÔ∏è'}</div>
                    <div style="flex: 1;">
                        <div style="font-weight: 600; font-size: 0.9rem;">
                            ${food.name} ${food.quantity > 1 ? `(x${food.quantity})` : ''}
                        </div>
                        <div style="font-size: 0.75rem; color: #636e72;">${food.time}</div>
                    </div>
                    <div style="font-weight: bold; color: #667eea; margin-right: 8px;">${food.totalPoints}</div>
                    <button class="btn btn-remove" onclick="removeFood(${index})">-</button>
                </div>
            `).join('');

            const total = consumedFoods.reduce((sum, food) => sum + food.totalPoints, 0);
            totalPointsConsumed.textContent = total;
        }

        // Utility functions
        function showToast(message) {
            const toast = document.getElementById('toast');
            toast.textContent = message;
            toast.classList.add('show');
            
            setTimeout(() => {
                toast.classList.remove('show');
            }, 3000);
        }

        // Reset function
        function resetAllData() {
            if (confirm('‚ö†Ô∏è √ätes-vous s√ªr de vouloir effacer toutes les donn√©es ?')) {
                // Clear localStorage
                localStorage.removeItem(STORAGE_KEY);
                localStorage.removeItem(BACKUP_KEY);
                
                // Reset variables
                initializeDefaultData();
                
                // Clear form fields
                document.getElementById('userName').value = '';
                document.getElementById('userAge').value = '';
                document.getElementById('userGender').value = '';
                document.getElementById('userHeight').value = '';
                document.getElementById('currentWeight').value = '';
                document.getElementById('targetWeight').value = '';
                document.getElementById('activityLevel').value = '';
                document.getElementById('weightLossGoal').value = '';
                document.getElementById('manualPoints').value = '';
                document.getElementById('foodSearch').value = '';
                
                // Reset displays
                document.getElementById('calculationResults').style.display = 'none';
                document.getElementById('profileStats').style.display = 'none';
                document.getElementById('profileStatus').classList.remove('profile-complete');
                document.getElementById('profileTitle').textContent = 'üéØ Configuration de votre profil';
                document.getElementById('profileSubtitle').textContent = 'Personnalisez vos points selon votre m√©tabolisme';
                document.getElementById('genderRangeInfo').style.display = 'none';
                
                toggleCalculationMode('auto');
                updateDisplay();
                updateWeeklyPointsDisplay();
                renderFoodGrid();
                updateHistoryDisplay();
                
                showToast('üóëÔ∏è Toutes les donn√©es ont √©t√© effac√©es');
            }
        }

        // Auto-save every 30 seconds
        setInterval(saveData, 30000);

        // Save before page unload
        window.addEventListener('beforeunload', function() {
            saveData();
        });

        // Save when page becomes hidden (mobile app switching)
        document.addEventListener('visibilitychange', function() {
            if (document.hidden) {
                saveData();
            }
        });

        // Save when app loses focus
        window.addEventListener('blur', function() {
            saveData();
        });

        // Keyboard shortcuts
        document.addEventListener('keydown', function(e) {
            // Ctrl/Cmd + R for reset (hidden feature)
            if ((e.ctrlKey || e.metaKey) && e.shiftKey && e.key === 'R') {
                e.preventDefault();
                resetAllData();
            }
            
            // Escape to clear search
            if (e.key === 'Escape') {
                document.getElementById('foodSearch').value = '';
                filterFoods();
            }
        });

        // Touch and interaction improvements
        document.addEventListener('touchstart', function() {}, { passive: true });
        
        // Prevent zoom on double tap for better mobile experience
        let lastTouchEnd = 0;
        document.addEventListener('touchend', function(event) {
            const now = (new Date()).getTime();
            if (now - lastTouchEnd <= 300) {
                event.preventDefault();
            }
            lastTouchEnd = now;
        }, false);

        console.log('üèãÔ∏è‚Äç‚ôÄÔ∏è Antomani Weight App with localStorage persistence loaded successfully!');
// ========================================
        // FONCTIONS INT√âGRATIONS
        // ========================================

        /**
         * Afficher le statut de la cl√© API
         */
        function updateApiKeyStatus() {
            const statusDiv = document.getElementById('apiKeyStatus');
            if (statusDiv) {
                const hasKey = localStorage.getItem('perplexity_api_key');
                if (hasKey) {
                    statusDiv.innerHTML = '‚úÖ Cl√© API configur√©e';
                    statusDiv.style.color = '#56ab2f';
                } else {
                    statusDiv.innerHTML = '‚ö†Ô∏è Cl√© API non configur√©e - Cliquez sur le bouton ci-dessus';
                    statusDiv.style.color = '#f39c12';
                }
            }
        }

        /**
         * Afficher les applications sant√©
         */
        function renderHealthApps() {
            const grid = document.getElementById('healthAppsGrid');
            if (!grid) return;

            const apps = {
                googleFit: { name: 'Google Fit', icon: 'üí™', available: true },
                appleHealth: { name: 'Apple Health', icon: '‚ù§Ô∏è', available: false },
                garmin: { name: 'Garmin', icon: '‚åö', available: true },
                fitbit: { name: 'Fitbit', icon: 'üèÉ', available: true },
                strava: { name: 'Strava', icon: 'üö¥', available: true },
                xiaomi: { name: 'Mi Fit', icon: 'üì±', available: true },
                samsung: { name: 'Samsung Health', icon: '‚ö°', available: false }
            };

            grid.innerHTML = Object.entries(apps).map(([id, app]) => {
                const isConnected = checkIfAppConnected(id);
                return `
                    <div class="health-app-card ${isConnected ? 'connected' : ''}" 
                         onclick="handleHealthAppClick('${id}')">
                        <div class="connection-badge ${isConnected ? 'connected' : ''}"></div>
                        <div class="health-app-icon">${app.icon}</div>
                        <div class="health-app-name">${app.name}</div>
                        <div class="health-app-status ${isConnected ? 'connected' : ''}">
                            ${isConnected ? 'Connect√©e ‚úì' : 'Non connect√©e'}
                        </div>
                    </div>
                `;
            }).join('');
        }

        /**
         * V√©rifier si une app est connect√©e
         */
        function checkIfAppConnected(appId) {
            const connections = JSON.parse(localStorage.getItem('health_connections') || '{}');
            return connections[appId]?.connected || false;
        }

        /**
         * G√©rer le clic sur une app sant√©
         */
        function handleHealthAppClick(appId) {
            const isConnected = checkIfAppConnected(appId);
            
            if (isConnected) {
                if (confirm('Voulez-vous d√©connecter cette application ?')) {
                    disconnectHealthApp(appId);
                }
            } else {
                connectHealthApp(appId);
            }
        }

        /**
         * Connecter une app sant√©
         */
        function connectHealthApp(appId) {
            showToast('üîÑ Connexion en cours...');
            
            // Simuler une connexion (√† remplacer par la vraie logique OAuth)
            setTimeout(() => {
                const connections = JSON.parse(localStorage.getItem('health_connections') || '{}');
                connections[appId] = {
                    connected: true,
                    connectedAt: new Date().toISOString()
                };
                localStorage.setItem('health_connections', JSON.stringify(connections));
                
                renderHealthApps();
                updateConnectedAppsList();
                showToast('‚úÖ Connect√© avec succ√®s !');
            }, 1000);
        }

        /**
         * D√©connecter une app sant√©
         */
        function disconnectHealthApp(appId) {
            const connections = JSON.parse(localStorage.getItem('health_connections') || '{}');
            delete connections[appId];
            localStorage.setItem('health_connections', JSON.stringify(connections));
            
            renderHealthApps();
            updateConnectedAppsList();
            showToast('‚ùå Application d√©connect√©e');
        }

        /**
 * Synchroniser toutes les apps (VERSION R√âELLE pour iOS)
 */
function syncAllHealthApps() {
    const connections = JSON.parse(localStorage.getItem('health_connections') || '{}');
    const connected = Object.keys(connections).filter(id => connections[id].connected);
    
    if (connected.length === 0) {
        showSyncMessage('‚ÑπÔ∏è Aucune application connect√©e', 'info');
        return;
    }
    
    showSyncMessage('üîÑ Synchronisation en cours...', 'info');
    
    // R√©cup√©rer les vraies donn√©es d'Apple HealthKit
    requestHealthKitData()
        .then(data => {
            if (data) {
                // R√©cup√©rer les donn√©es du jour dernier (si elles existent)
                const lastSyncKey = 'lastHealthKitSync_' + getDateKey(new Date(Date.now() - 86400000));
                const lastSync = JSON.parse(localStorage.getItem(lastSyncKey) || '{}');
                
                // Calculer SEULEMENT la diff√©rence
                const stepsToAdd = Math.max(0, (data.steps || 0) - (lastSync.steps || 0));
                const caloriesToAdd = Math.max(0, (data.calories || 0) - (lastSync.calories || 0));
                
                // Sauvegarder les donn√©es d'aujourd'hui
                const todayKey = 'lastHealthKitSync_' + getDateKey(new Date());
                localStorage.setItem(todayKey, JSON.stringify({
                    steps: data.steps || 0,
                    calories: data.calories || 0,
                    syncedAt: new Date().toISOString()
                }));
                
                // Ajouter SEULEMENT la diff√©rence
                if (stepsToAdd > 0) {
                    addStepsFromHealthApp(stepsToAdd);
                }
                if (caloriesToAdd > 0) {
                    addCaloriesFromHealthApp(caloriesToAdd);
                }
                
                showSyncMessage(`‚úÖ ${connected.length} app(s) synchronis√©e(s)`, 'success');
            } else {
                showSyncMessage('‚ùå Impossible de r√©cup√©rer les donn√©es', 'error');
            }
        })
        .catch(err => {
            console.error('Erreur sync:', err);
            showSyncMessage('‚ùå Erreur de synchronisation', 'error');
        });
}

/**
 * R√©cup√©rer les vraies donn√©es d'Apple HealthKit
 */
async function requestHealthKitData() {
    try {
        // ‚úÖ APPEL R√âEL √Ä HEALTHKIT (fonctionne sur iOS)
        if (window.webkit && window.webkit.messageHandlers) {
            return new Promise((resolve) => {
                window.webkit.messageHandlers.getHealthKitData.postMessage({
                    types: ['steps', 'activeEnergy']
                });
                
                // √âcouter la r√©ponse
                window.onHealthKitData = (data) => {
                    resolve({
                        steps: data.steps || 0,
                        calories: data.calories || 0
                    });
                };
                
                // Timeout apr√®s 10 secondes
                setTimeout(() => resolve(null), 10000);
            });
        } else {
            // Fallback pour le web (simulation)
            console.log('‚ö†Ô∏è HealthKit non disponible, utilisation de donn√©es simul√©es');
            return {
                steps: 5000,
                calories: 200
            };
        }
    } catch (err) {
        console.error('Erreur HealthKit:', err);
        return null;
    }
}

        /**
         * Afficher un message de sync
         */
        function showSyncMessage(message, type) {
            const msgDiv = document.getElementById('syncStatusMessage');
            if (msgDiv) {
                msgDiv.className = type;
                msgDiv.textContent = message;
                msgDiv.style.display = 'block';
                
                setTimeout(() => {
                    msgDiv.style.display = 'none';
                }, 5000);
            }
        }

        /**
         * Mettre √† jour la liste des apps connect√©es
         */
        function updateConnectedAppsList() {
            const section = document.getElementById('connectedAppsSection');
            const list = document.getElementById('connectedAppsList');
            
            if (!section || !list) return;
            
            const connections = JSON.parse(localStorage.getItem('health_connections') || '{}');
            const connected = Object.entries(connections).filter(([_, conn]) => conn.connected);
            
            if (connected.length === 0) {
                section.style.display = 'none';
                return;
            }

            const appsNames = {
                googleFit: { name: 'Google Fit', icon: 'üí™' },
                appleHealth: { name: 'Apple Health', icon: '‚ù§Ô∏è' },
                garmin: { name: 'Garmin', icon: '‚åö' },
                fitbit: { name: 'Fitbit', icon: 'üèÉ' },
                strava: { name: 'Strava', icon: 'üö¥' },
                xiaomi: { name: 'Mi Fit', icon: 'üì±' },
                samsung: { name: 'Samsung Health', icon: '‚ö°' }
            };

            section.style.display = 'block';
            list.innerHTML = connected.map(([id, conn]) => {
                const app = appsNames[id] || { name: id, icon: 'üì±' };
                const date = new Date(conn.connectedAt).toLocaleDateString('fr-FR');
                return `
                    <div class="connected-app-item">
                        <div class="connected-app-info">
                            <span style="font-size: 1.5rem;">${app.icon}</span>
                            <div>
                                <div style="font-weight: 600; font-size: 0.9rem;">${app.name}</div>
                                <div style="font-size: 0.7rem; color: #636e72;">
                                    Connect√©e le ${date}
                                </div>
                            </div>
                        </div>
                        <button class="disconnect-btn" onclick="handleHealthAppClick('${id}')">
                            D√©connecter
                        </button>
                    </div>
                `;
            }).join('');
        }

        /**
         * G√©rer le toggle auto-sync
         */
        function handleAutoSyncToggle(enabled) {
            localStorage.setItem('autoSync', enabled ? 'true' : 'false');
            if (enabled) {
                const frequency = parseInt(document.getElementById('syncFrequency').value);
                showToast(`‚úÖ Sync auto activ√©e (${frequency}min)`);
            } else {
                showToast('‚ùå Sync auto d√©sactiv√©e');
            }
        }

        /**
         * Mettre √† jour la fr√©quence de sync
         */
        function updateSyncFrequency() {
            const frequency = document.getElementById('syncFrequency').value;
            const isEnabled = document.getElementById('autoSyncToggle').checked;
            
            if (isEnabled) {
                showToast(`üîÑ Fr√©quence : ${frequency} minutes`);
            }
        }

        /**
         * Toggle auto-sync (bouton)
         */
        function toggleAutoSync() {
            const toggle = document.getElementById('autoSyncToggle');
            toggle.checked = !toggle.checked;
            handleAutoSyncToggle(toggle.checked);
        }

        /**
 * Ajouter des √©tapes depuis une app sant√© (AVEC D√âTECTION DE DOUBLON)
 */
function addStepsFromHealthApp(steps) {
    if (steps > 0) {
        // Chercher si on a d√©j√† des √©tapes synchro aujourd'hui
        const today = new Date().toLocaleDateString('fr-FR');
        const existingActivityIndex = activities.findIndex(a => 
            a.type === 'steps' && 
            a.source === 'üîó Sync app' &&
            a.date === today // Ajoute cette propri√©t√© quand on cr√©e l'activit√©
        );

        const pointsBefore = calculateCumulativeStepsPoints();
        
        // SI on a trouv√© une activit√© existante AUJOURD'HUI : on la remplace
        // SINON : on en ajoute une nouvelle
        if (existingActivityIndex !== -1) {
            // REMPLACER l'existant
            const oldValue = activities[existingActivityIndex].value;
            totalSteps = totalSteps - oldValue + steps; // Soustraire l'ancien, ajouter le nouveau
            activities[existingActivityIndex].value = steps;
        } else {
            // AJOUTER une nouvelle
            totalSteps += steps;
        }
        
        const pointsAfter = calculateCumulativeStepsPoints();
        const pointsGained = pointsAfter - pointsBefore;
        
        if (pointsGained > 0) {
            if (existingActivityIndex !== -1) {
                // Mettre √† jour le message de temps
                activities[existingActivityIndex].points = pointsGained;
                activities[existingActivityIndex].time = new Date().toLocaleTimeString('fr-FR', { hour: '2-digit', minute: '2-digit' });
            } else {
                // Cr√©er une nouvelle activit√©
                activities.push({
                    type: 'steps',
                    value: steps,
                    points: pointsGained,
                    time: new Date().toLocaleTimeString('fr-FR', { hour: '2-digit', minute: '2-digit' }),
                    date: today, // Ajouter la date
                    source: 'üîó Sync app'
                });
            }
        }
        
        updateCumulativeDisplays();
        updateActivityDisplay();
        updateDisplay();
        saveData();
    }
}

/**
 * Ajouter des calories depuis une app sant√© (AVEC D√âTECTION DE DOUBLON)
 */
function addCaloriesFromHealthApp(calories) {
    if (calories > 0) {
        // Chercher si on a d√©j√† des calories synchro aujourd'hui
        const today = new Date().toLocaleDateString('fr-FR');
        const existingActivityIndex = activities.findIndex(a => 
            a.type === 'calories' && 
            a.source === 'üîó Sync app' &&
            a.date === today
        );

        const pointsBefore = calculateCumulativeCaloriesPoints();
        
        // SI on a trouv√© une activit√© existante AUJOURD'HUI : on la remplace
        // SINON : on en ajoute une nouvelle
        if (existingActivityIndex !== -1) {
            // REMPLACER l'existant
            const oldValue = activities[existingActivityIndex].value;
            totalCalories = totalCalories - oldValue + calories; // Soustraire l'ancien, ajouter le nouveau
            activities[existingActivityIndex].value = calories;
        } else {
            // AJOUTER une nouvelle
            totalCalories += calories;
        }
        
        const pointsAfter = calculateCumulativeCaloriesPoints();
        const pointsGained = pointsAfter - pointsBefore;
        
        if (pointsGained > 0) {
            if (existingActivityIndex !== -1) {
                // Mettre √† jour l'activit√© existante
                activities[existingActivityIndex].points = pointsGained;
                activities[existingActivityIndex].time = new Date().toLocaleTimeString('fr-FR', { hour: '2-digit', minute: '2-digit' });
            } else {
                // Cr√©er une nouvelle activit√©
                activities.push({
                    type: 'calories',
                    value: calories,
                    points: pointsGained,
                    time: new Date().toLocaleTimeString('fr-FR', { hour: '2-digit', minute: '2-digit' }),
                    date: today, // Ajouter la date
                    source: 'üîó Sync app'
                });
            }
        }
        
        updateCumulativeDisplays();
        updateActivityDisplay();
        updateDisplay();
        saveData();
    }
}


        // Fonctions pour les modals (placeholders - seront remplac√©es par les vrais modules)
        /**
 * Afficher le modal de scan photo (version simplifi√©e)
 */
function showPhotoScanModal() {
    // V√©rifier si une cl√© API est configur√©e
    const apiKey = localStorage.getItem('perplexity_api_key');
    
    if (!apiKey) {
        if (confirm('‚ö†Ô∏è Cl√© API non configur√©e\n\nVoulez-vous la configurer maintenant ?')) {
            showApiKeyModal();
        }
        return;
    }
    
    const modal = document.createElement('div');
    modal.style.cssText = 'position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.9); z-index: 10000; display: flex; align-items: center; justify-content: center; padding: 20px; overflow-y: auto;';
    
    modal.innerHTML = `
        <div style="background: white; border-radius: 12px; padding: 20px; max-width: 500px; width: 100%; max-height: 90vh; overflow-y: auto;">
            <h3 style="margin-bottom: 15px; font-size: 1.2rem;">üì∏ Scanner un aliment</h3>
            
            <!-- Zone de preview -->
            <div id="photoPreview" style="width: 100%; min-height: 200px; border: 2px dashed #667eea; border-radius: 8px; display: flex; align-items: center; justify-content: center; margin-bottom: 15px; background: #f8f9fa; position: relative; overflow: hidden;">
                <div id="previewPlaceholder" style="text-align: center; color: #636e72;">
                    <div style="font-size: 3rem; margin-bottom: 10px;">üì∑</div>
                    <div>Prenez une photo ou s√©lectionnez une image</div>
                </div>
                <img id="previewImage" style="display: none; width: 100%; height: auto; max-height: 300px; object-fit: contain;">
            </div>
            
            <!-- Boutons d'action -->
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 8px; margin-bottom: 15px;">
                <button onclick="triggerCamera()" style="padding: 12px; background: #667eea; color: white; border: none; border-radius: 8px; font-weight: 600; cursor: pointer;">
                    üì∑ Appareil photo
                </button>
                <button onclick="triggerGallery()" style="padding: 12px; background: #667eea; color: white; border: none; border-radius: 8px; font-weight: 600; cursor: pointer;">
                    üñºÔ∏è Galerie
                </button>
            </div>
            
            <!-- Input cach√© pour la photo -->
            <input type="file" id="photoInput" accept="image/*" capture="environment" style="display: none;">
            <input type="file" id="galleryInput" accept="image/*" style="display: none;">
            
            <!-- Zone de r√©sultats -->
            <div id="scanResults" style="display: none; background: #f8f9fa; padding: 15px; border-radius: 8px; margin-bottom: 15px;">
                <div style="margin-bottom: 10px;">
                    <strong>Aliment d√©tect√©:</strong>
                    <div id="detectedFood" style="font-size: 1.1rem; color: #667eea; margin-top: 5px;"></div>
                </div>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-top: 10px;">
                    <div>
                        <small style="color: #636e72;">Calories estim√©es</small>
                        <div id="detectedCalories" style="font-weight: bold;"></div>
                    </div>
                    <div>
                        <small style="color: #636e72;">Points</small>
                        <div id="detectedPoints" style="font-weight: bold; color: #667eea;"></div>
                    </div>
                </div>
                <div style="margin-top: 10px;">
                    <small style="color: #636e72;">Portion</small>
                    <div id="detectedPortion" style="font-weight: bold;"></div>
                </div>
                <div style="margin-top: 10px;">
                    <small style="color: #636e72;">Confiance</small>
                    <div id="detectedConfidence" style="font-weight: bold;"></div>
                </div>
            </div>
            
            <!-- Loading spinner -->
            <div id="scanLoading" style="display: none; text-align: center; padding: 20px;">
                <div style="font-size: 2rem; animation: spin 1s linear infinite;">üîÑ</div>
                <div style="margin-top: 10px; color: #636e72;">Analyse en cours...</div>
            </div>
            
            <!-- Boutons bas -->
            <div style="display: flex; gap: 8px;">
                <button id="addScannedFoodBtn" style="flex: 1; padding: 14px; background: #56ab2f; color: white; border: none; border-radius: 8px; font-weight: 600; display: none; cursor: pointer;">
                    ‚úÖ Ajouter
                </button>
                <button onclick="closePhotoScanModal()" style="flex: 1; padding: 14px; background: #e9ecef; color: #2d3436; border: none; border-radius: 8px; font-weight: 600; cursor: pointer;">
                    Annuler
                </button>
            </div>
        </div>
    `;
    
    // Ajouter l'animation de rotation
    const style = document.createElement('style');
    style.textContent = '@keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }';
    document.head.appendChild(style);
    
    modal.id = 'photoScanModal';
    document.body.appendChild(modal);
    document.body.style.overflow = 'hidden';
    
    // Event listeners pour les inputs
    document.getElementById('photoInput').addEventListener('change', (e) => handlePhotoSelected(e.target.files[0]));
    document.getElementById('galleryInput').addEventListener('change', (e) => handlePhotoSelected(e.target.files[0]));
}

/**
 * D√©clencher l'appareil photo
 */
function triggerCamera() {
    document.getElementById('photoInput').click();
}

/**
 * D√©clencher la galerie
 */
function triggerGallery() {
    document.getElementById('galleryInput').click();
}

/**
 * G√©rer la photo s√©lectionn√©e
 */
async function handlePhotoSelected(file) {
    if (!file) return;
    
    // Afficher preview
    const preview = document.getElementById('previewImage');
    const placeholder = document.getElementById('previewPlaceholder');
    const reader = new FileReader();
    
    reader.onload = (e) => {
        preview.src = e.target.result;
        preview.style.display = 'block';
        placeholder.style.display = 'none';
    };
    reader.readAsDataURL(file);
    
    // Afficher loading
    document.getElementById('scanLoading').style.display = 'block';
    document.getElementById('scanResults').style.display = 'none';
    
    try {
        // Analyser avec l'IA Perplexity
        const foodData = await analyzePhotoWithPerplexity(file);
        
        // Afficher les r√©sultats
        displayScanResults(foodData);
        
    } catch (error) {
        console.error('Erreur scan:', error);
        alert(`‚ùå Erreur: ${error.message}`);
        document.getElementById('scanLoading').style.display = 'none';
    }
}

/**
 * Analyser une photo avec Perplexity AI
 */
async function analyzePhotoWithPerplexity(imageFile) {
    const apiKey = localStorage.getItem('perplexity_api_key');
    
    if (!apiKey) {
        throw new Error('Cl√© API non configur√©e');
    }
    
    // Convertir l'image en base64
    const base64Image = await new Promise((resolve, reject) => {
        const reader = new FileReader();
        reader.onload = () => {
            const base64 = reader.result.split(',')[1];
            resolve(base64);
        };
        reader.onerror = reject;
        reader.readAsDataURL(imageFile);
    });
    
// Cr√©er le prompt pour l'IA
    const prompt = `Tu es un expert nutritionniste certifi√© Weight Watchers PersonalPoints‚Ñ¢ 2024. Analyse cette photo d'assiette avec PR√âCISION MAXIMALE.

MISSION CRITIQUE :
Pour CHAQUE aliment visible, tu DOIS fournir :
1. Quantit√© en grammes (estimation r√©aliste)
2. Calories totales
3. Graisses satur√©es (g)
4. Sucres (g)
5. Prot√©ines (g)

LISTE ZEROPOINT WEIGHT WATCHERS 2024 (0 points garantis) :
L√âGUMES : √©pinards, brocoli, chou-fleur, courgettes, haricots verts, asperges, poivrons, tomates, concombre, salade, champignons, aubergine, c√©leri, radis, chou, betteraves, carottes crues
FRUITS : pomme, banane, orange, fraise, myrtille, raisin, melon, past√®que, p√™che, poire, kiwi, ananas, mangue, papaye, fruits rouges
PROT√âINES MAIGRES : blanc de poulet SANS PEAU (cuit sans mati√®re grasse), blanc de dinde SANS PEAU, poisson blanc (cabillaud, sole, lieu), fruits de mer (crevettes, moules, calamars)
LAITIERS : yaourt nature 0%, fromage blanc 0%
AUTRES : ≈ìufs entiers (2/jour max), tofu nature, tempeh

ATTENTION - CES ALIMENTS NE SONT PAS ZEROPOINT :
‚ùå Poulet AVEC peau = calculer les points
‚ùå Viandes grasses = calculer les points  
‚ùå Pommes de terre (m√™me vapeur) = calculer les points
‚ùå Riz, p√¢tes, pain, quinoa = calculer les points
‚ùå Avocat = calculer les points
‚ùå Huiles, beurre = calculer les points
‚ùå Fromages = calculer les points
‚ùå Fruits secs, noix = calculer les points
‚ùå L√©gumineuses (lentilles, pois chiches) = calculer les points

FORMULE WEIGHT WATCHERS PERSONNALPOINTS‚Ñ¢ 2024 :
Points = (Calories √ó 0.0305) + (Graisses satur√©es √ó 0.275) + (Sucres √ó 0.12) - (Prot√©ines √ó 0.098)
Minimum : 0 point
Arrondi : au 0.5 le plus proche

R√©ponds UNIQUEMENT au format JSON (sans texte, sans backticks) :

{
  "name": "description compl√®te et pr√©cise du plat",
  "components": [
    {
      "item": "nom pr√©cis de l'aliment",
      "quantity_g": quantit√© en grammes (nombre entier),
      "calories": calories totales (nombre),
      "saturated_fat_g": graisses satur√©es en grammes (nombre d√©cimal),
      "sugar_g": sucres en grammes (nombre d√©cimal),
      "protein_g": prot√©ines en grammes (nombre d√©cimal),
      "is_zeropoint": true/false (selon liste ZeroPoint ci-dessus),
      "ww_points": points WW calcul√©s avec la formule (0 si ZeroPoint),
      "category": "proteines/legumes/cereales/fruits/graisses",
      "icon": "emoji"
    }
  ],
  "category": "plats_cuisines",
  "total_calories": somme calories,
  "total_ww_points": somme points WW,
  "portion_size": "description d√©taill√©e avec poids",
  "confidence": 0-100,
  "icon": "emoji principal"
}

EXEMPLE R√âALISTE - Cuisse poulet + pommes de terre + brocoli :
{
  "name": "cuisse de poulet r√¥tie avec pommes de terre et brocoli",
  "components": [
    {
      "item": "cuisse de poulet avec peau",
      "quantity_g": 120,
      "calories": 250,
      "saturated_fat_g": 3.5,
      "sugar_g": 0,
      "protein_g": 25,
      "is_zeropoint": false,
      "ww_points": 5,
      "category": "proteines",
      "icon": "üçó"
    },
    {
      "item": "pommes de terre r√¥ties",
      "quantity_g": 150,
      "calories": 180,
      "saturated_fat_g": 0.1,
      "sugar_g": 2,
      "protein_g": 4,
      "is_zeropoint": false,
      "ww_points": 5,
      "category": "cereales",
      "icon": "ü•î"
    },
    {
      "item": "brocoli vapeur",
      "quantity_g": 100,
      "calories": 35,
      "saturated_fat_g": 0,
      "sugar_g": 2,
      "protein_g": 3,
      "is_zeropoint": true,
      "ww_points": 0,
      "category": "legumes",
      "icon": "ü•¶"
    }
  ],
  "category": "plats_cuisines",
  "total_calories": 465,
  "total_ww_points": 10,
  "portion_size": "1 cuisse de poulet 120g, 150g pommes de terre, 100g brocoli",
  "confidence": 85,
  "icon": "üçó"
}`;
   
    // Appel API Perplexity
    const response = await fetch('https://api.perplexity.ai/chat/completions', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
            'Authorization': `Bearer ${apiKey}`
        },
        body: JSON.stringify({
            model: 'sonar-pro',
            messages: [
                {
                    role: 'user',
                    content: [
                        { type: 'text', text: prompt },
                        { 
                            type: 'image_url',
                            image_url: { url: `data:image/jpeg;base64,${base64Image}` }
                        }
                    ]
                }
            ]
        })
    });

    if (!response.ok) {
        const errorText = await response.text();
        throw new Error(`Erreur API (${response.status}): ${errorText}`);
    }

    const data = await response.json();
    const aiResponse = data.choices[0].message.content;
    
    // Parser la r√©ponse JSON
    let foodData;
    try {
        // Extraire le JSON s'il est entour√© de texte
        const jsonMatch = aiResponse.match(/\{[\s\S]*\}/);
        if (jsonMatch) {
            foodData = JSON.parse(jsonMatch[0]);
        } else {
            foodData = JSON.parse(aiResponse);
        }
    } catch (error) {
        console.error('Erreur parsing JSON:', error);
        throw new Error('Format de r√©ponse invalide');
    }
    
    // Calculer les points (80 cal = 1 point)
    foodData.points = Math.round(foodData.estimated_calories / 80);
    
    return foodData;
}

/**
 * Afficher les r√©sultats du scan avec ajustement interactif
 */
function displayScanResults(foodData) {
    document.getElementById('scanLoading').style.display = 'none';
    document.getElementById('scanResults').style.display = 'none';
    
    // Cr√©er une nouvelle section d'ajustement
    let adjustmentSection = document.getElementById('adjustmentSection');
    if (!adjustmentSection) {
        adjustmentSection = document.createElement('div');
        adjustmentSection.id = 'adjustmentSection';
        document.getElementById('photoScanModal').querySelector('div').appendChild(adjustmentSection);
    }
    
    // Stocker les donn√©es pour les calculs
    window.currentFoodData = foodData;
    
    adjustmentSection.style.cssText = 'background: #f8f9fa; padding: 15px; border-radius: 12px; margin-bottom: 15px;';
    adjustmentSection.innerHTML = `
        <!-- R√©sum√© principal -->
        <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); padding: 15px; border-radius: 10px; margin-bottom: 15px; color: white;">
            <div style="font-size: 1.3rem; font-weight: bold; margin-bottom: 5px;">
                ${foodData.icon} ${foodData.name}
            </div>
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-top: 10px;">
                <div>
                    <div style="font-size: 0.75rem; opacity: 0.9;">Calories totales</div>
                    <div style="font-size: 1.3rem; font-weight: bold;" id="totalCaloriesDisplay">${foodData.total_calories}</div>
                </div>
                <div>
                    <div style="font-size: 0.75rem; opacity: 0.9;">Points WW</div>
                    <div style="font-size: 1.3rem; font-weight: bold;" id="totalPointsDisplay">${foodData.total_ww_points}</div>
                </div>
            </div>
            <div style="margin-top: 8px; font-size: 0.75rem; opacity: 0.9;">
                Confiance : ${foodData.confidence}%
            </div>
        </div>

        <!-- Titre section ajustement -->
        <div style="font-weight: 600; margin-bottom: 12px; color: #2d3436; display: flex; align-items: center; gap: 8px;">
            <span>üìã Ajuster les portions</span>
            <button onclick="resetAllPortions()" style="margin-left: auto; padding: 4px 8px; background: #e9ecef; border: none; border-radius: 6px; font-size: 0.75rem; cursor: pointer;">
                üîÑ Reset
            </button>
        </div>

        <!-- Liste des composants ajustables -->
        <div id="componentsAdjustment" style="display: flex; flex-direction: column; gap: 10px;">
            ${generateComponentsAdjustment(foodData.components)}
        </div>

        <!-- Portion size info -->
        <div style="background: white; padding: 10px; border-radius: 8px; margin-top: 15px; font-size: 0.8rem; color: #636e72;">
            <strong>‚ÑπÔ∏è Portion estim√©e :</strong><br>
            ${foodData.portion_size}
        </div>
    `;
    
    adjustmentSection.style.display = 'block';
    
    // Afficher le bouton d'ajout
    const addButton = document.getElementById('addScannedFoodBtn');
    addButton.style.display = 'block';
    addButton.onclick = () => {
        const adjustedData = calculateAdjustedTotals();
        addFood(adjustedData.name, adjustedData.points, adjustedData.icon);
        closePhotoScanModal();
    };
}

/**
 * G√©n√©rer le HTML pour chaque composant ajustable
 */
function generateComponentsAdjustment(components) {
    if (!components || components.length === 0) {
        return '<div style="text-align: center; color: #636e72;">Aucun composant d√©tect√©</div>';
    }
    
    return components.map((comp, index) => {
        const pointsColor = comp.ww_points === 0 ? '#27ae60' : '#667eea';
        
        return `
            <div class="component-card" style="background: white; padding: 12px; border-radius: 10px; border: 2px solid #e9ecef;">
                <!-- En-t√™te du composant -->
                <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 10px;">
                    <span style="font-size: 1.5rem;">${comp.icon}</span>
			<div style="flex: 1;">
                        <div style="font-weight: 600; font-size: 0.9rem; color: #2d3436;">${comp.item}</div>
                        <div style="font-size: 0.7rem; color: #636e72;">
                            <span id="quantity-${index}">${comp.quantity_g}g</span> ‚Ä¢ 
                            <span id="calories-${index}">${comp.calories}</span> kcal
                        </div>
                        ${comp.is_zeropoint ? 
                            '<div style="font-size: 0.65rem; color: #27ae60; font-weight: 600; margin-top: 2px;">‚ú® ZeroPoint WW</div>' : 
                            `<div style="font-size: 0.65rem; color: #95a5a6; margin-top: 2px;">
                                G.Sat: ${comp.saturated_fat_g || 0}g ‚Ä¢ Sucres: ${comp.sugar_g || 0}g ‚Ä¢ Prot: ${comp.protein_g || 0}g
                            </div>`
                        }
                    </div>                     
                    <div style="background: ${pointsColor}; color: white; padding: 6px 10px; border-radius: 12px; font-weight: bold; font-size: 0.85rem;">
                        <span id="points-${index}">${comp.ww_points}</span> pts
                    </div>
                </div>

                <!-- Slider d'ajustement -->
                <div style="margin-top: 12px;">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;">
                        <span style="font-size: 0.75rem; color: #636e72;">Portion :</span>
                        <span style="font-size: 0.85rem; font-weight: 600; color: #667eea;" id="percentage-${index}">100%</span>
                    </div>
                    
                    <input 
                        type="range" 
                        id="slider-${index}" 
                        min="0" 
                        max="200" 
                        value="100" 
                        step="10"
                        style="width: 100%; height: 6px; border-radius: 3px; outline: none; -webkit-appearance: none; background: linear-gradient(90deg, #e9ecef 0%, #667eea 50%, #e9ecef 100%);"
                        oninput="adjustComponent(${index}, this.value)"
                         data-base-quantity="${comp.quantity_g}"
                        data-base-calories="${comp.calories}"
                        data-base-points="${comp.ww_points}"
                        data-base-sat-fat="${comp.saturated_fat_g || 0}"
                        data-base-sugar="${comp.sugar_g || 0}"
                        data-base-protein="${comp.protein_g || 0}"
                        data-is-zeropoint="${comp.is_zeropoint || false}"
                    >
                    
                    <!-- Marqueurs de r√©f√©rence -->
                    <div style="display: flex; justify-content: space-between; font-size: 0.65rem; color: #b2bec3; margin-top: 4px;">
                        <span>0%</span>
                        <span>50%</span>
                        <span>100%</span>
                        <span>150%</span>
                        <span>200%</span>
                    </div>
                </div>

                <!-- Bouton suppression -->
                <button 
                    onclick="removeComponent(${index})" 
                    style="width: 100%; margin-top: 10px; padding: 6px; background: #fee; color: #e74c3c; border: 1px solid #fcc; border-radius: 6px; font-size: 0.75rem; cursor: pointer; font-weight: 600;">
                    üóëÔ∏è Retirer cet aliment
                </button>
            </div>
        `;
    }).join('');
}

/**
 * Ajuster un composant selon le slider
 */
function adjustComponent(index, percentage) {
    const slider = document.getElementById(`slider-${index}`);
    const baseQuantity = parseFloat(slider.dataset.baseQuantity);
    const baseCalories = parseFloat(slider.dataset.baseCalories);
    const basePoints = parseFloat(slider.dataset.basePoints);
    
    const factor = percentage / 100;
    
    // Calculer les nouvelles valeurs
    const newQuantity = Math.round(baseQuantity * factor);
    const newCalories = Math.round(baseCalories * factor);
    const newPoints = Math.round(basePoints * factor * 10) / 10; // Arrondi √† 0.5
    
    // Mettre √† jour l'affichage
    document.getElementById(`percentage-${index}`).textContent = `${percentage}%`;
    document.getElementById(`quantity-${index}`).textContent = `${newQuantity}g`;
    document.getElementById(`calories-${index}`).textContent = newCalories;
    document.getElementById(`points-${index}`).textContent = newPoints;
    
    // Recalculer le total
    updateTotals();
}

/**
 * Retirer un composant
 */
function removeComponent(index) {
    const slider = document.getElementById(`slider-${index}`);
    if (slider) {
        slider.value = 0;
        adjustComponent(index, 0);
        
        // Masquer visuellement
        const card = slider.closest('.component-card');
        if (card) {
            card.style.opacity = '0.3';
            card.style.pointerEvents = 'none';
        }
    }
}

/**
 * R√©initialiser toutes les portions √† 100%
 */
function resetAllPortions() {
    const sliders = document.querySelectorAll('input[type="range"][id^="slider-"]');
    sliders.forEach((slider, index) => {
        slider.value = 100;
        adjustComponent(index, 100);
        
        // R√©activer la carte
        const card = slider.closest('.component-card');
        if (card) {
            card.style.opacity = '1';
            card.style.pointerEvents = 'auto';
        }
    });
}

/**
 * Mettre √† jour les totaux
 */
function updateTotals() {
    let totalCalories = 0;
    let totalPoints = 0;
    
    const sliders = document.querySelectorAll('input[type="range"][id^="slider-"]');
    sliders.forEach((slider, index) => {
        const calories = parseFloat(document.getElementById(`calories-${index}`).textContent);
        const points = parseFloat(document.getElementById(`points-${index}`).textContent);
        
        totalCalories += calories;
        totalPoints += points;
    });
    
    // Afficher les totaux
    document.getElementById('totalCaloriesDisplay').textContent = totalCalories;
    document.getElementById('totalPointsDisplay').textContent = Math.round(totalPoints * 10) / 10;
}

/**
 * Calculer les donn√©es ajust√©es finales
 */
function calculateAdjustedTotals() {
    const foodData = window.currentFoodData;
    let totalCalories = 0;
    let totalPoints = 0;
    let componentsList = [];
    
    const sliders = document.querySelectorAll('input[type="range"][id^="slider-"]');
    sliders.forEach((slider, index) => {
        const percentage = parseInt(slider.value);
        if (percentage > 0) {
            const quantity = document.getElementById(`quantity-${index}`).textContent;
            const calories = parseFloat(document.getElementById(`calories-${index}`).textContent);
            const points = parseFloat(document.getElementById(`points-${index}`).textContent);
            const item = foodData.components[index].item;
            
            totalCalories += calories;
            totalPoints += points;
            
            if (percentage !== 100) {
                componentsList.push(`${item} (${percentage}%)`);
            } else {
                componentsList.push(item);
            }
        }
    });
    
    // Cr√©er le nom final
    let finalName = foodData.name;
    if (componentsList.length < foodData.components.length) {
        finalName += ' (modifi√©)';
    }
    
    return {
        name: finalName,
        calories: totalCalories,
        points: Math.round(totalPoints),
        icon: foodData.icon
    };
}

// Rendre les fonctions globales
window.adjustComponent = adjustComponent;
window.removeComponent = removeComponent;
window.resetAllPortions = resetAllPortions;
window.updateTotals = updateTotals;
window.calculateAdjustedTotals = calculateAdjustedTotals;

/**
 * Fermer le modal photo
 */
function closePhotoScanModal() {
    const modal = document.getElementById('photoScanModal');
    if (modal) {
        modal.remove();
        document.body.style.overflow = '';
    }
}

/**
 * Modal configuration API Key (version am√©lior√©e)
 */
function showApiKeyModal() {
    const modal = document.createElement('div');
    modal.style.cssText = 'position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); z-index: 10000; display: flex; align-items: center; justify-content: center; padding: 20px; overflow-y: auto;';
    
    const currentKey = localStorage.getItem('perplexity_api_key') || '';
    
    modal.innerHTML = `
        <div style="background: white; border-radius: 12px; padding: 20px; max-width: 500px; width: 100%; max-height: 90vh; overflow-y: auto;">
            <h3 style="margin-bottom: 15px;">üîë Configuration API Perplexity</h3>
            
            <div style="background: #fff3cd; padding: 12px; border-radius: 8px; margin-bottom: 15px; font-size: 0.85rem;">
                <strong>‚ÑπÔ∏è Obtenir une cl√© API:</strong><br>
                1. Allez sur <a href="https://www.perplexity.ai/settings/api" target="_blank" style="color: #667eea; text-decoration: underline;">perplexity.ai/settings/api</a><br>
                2. Cr√©ez un compte si n√©cessaire<br>
                3. G√©n√©rez une nouvelle cl√© API<br>
                4. Copiez-la ci-dessous
            </div>
            
            <div style="margin-bottom: 15px;">
                <label style="display: block; margin-bottom: 5px; font-weight: 500;">Cl√© API:</label>
                <input type="password" id="apiKeyInput" placeholder="pplx-..." 
                       style="width: 100%; padding: 12px; border: 2px solid #e9ecef; border-radius: 8px; font-size: 1rem;"
                       value="${currentKey}">
                <small style="color: #636e72; font-size: 0.75rem; display: block; margin-top: 5px;">
                    La cl√© commence g√©n√©ralement par "pplx-"
                </small>
            </div>
            
            <div style="display: flex; gap: 8px;">
                <button onclick="saveApiKeyFromModal()" style="flex: 1; padding: 14px; background: #667eea; color: white; border: none; border-radius: 8px; font-weight: 600; cursor: pointer;">
                    üíæ Enregistrer
                </button>
                <button onclick="closeApiKeyModal()" style="flex: 1; padding: 14px; background: #e9ecef; color: #2d3436; border: none; border-radius: 8px; font-weight: 600; cursor: pointer;">
                    Annuler
                </button>
            </div>
        </div>
    `;
    
    modal.id = 'apiKeyModal';
    document.body.appendChild(modal);
    document.body.style.overflow = 'hidden';
}

/**
 * Sauvegarder la cl√© API depuis le modal
 */
function saveApiKeyFromModal() {
    const apiKey = document.getElementById('apiKeyInput').value.trim();
    if (apiKey) {
        localStorage.setItem('perplexity_api_key', apiKey);
        updateApiKeyStatus();
        showToast('‚úÖ Cl√© API enregistr√©e !');
        closeApiKeyModal();
    } else {
        alert('‚ö†Ô∏è Veuillez entrer une cl√© API valide');
    }
}

/**
 * Fermer le modal de cl√© API
 */
function closeApiKeyModal() {
    const modal = document.getElementById('apiKeyModal');
    if (modal) {
        modal.remove();
        document.body.style.overflow = '';
    }
}

        function showApiKeyModal() {
            const currentKey = localStorage.getItem('perplexity_api_key') || '';
            const newKey = prompt('Entrez votre cl√© API Perplexity :\n(Obtenez-la sur perplexity.ai/settings/api)', currentKey);
            
            if (newKey !== null && newKey.trim()) {
                localStorage.setItem('perplexity_api_key', newKey.trim());
                updateApiKeyStatus();
                showToast('‚úÖ Cl√© API enregistr√©e !');
            }
        }

        // Initialiser l'onglet int√©grations au chargement
        document.addEventListener('DOMContentLoaded', function() {
            // ... ton code existant ...
            
            // Ajouter l'initialisation des int√©grations
            renderHealthApps();
            updateConnectedAppsList();
            updateApiKeyStatus();
            
            // Charger les param√®tres de sync
            const autoSyncEnabled = localStorage.getItem('autoSync') === 'true';
            const syncFreq = localStorage.getItem('syncFrequency') || '60';
            
            const autoSyncToggle = document.getElementById('autoSyncToggle');
            const syncFrequency = document.getElementById('syncFrequency');
            
            if (autoSyncToggle) autoSyncToggle.checked = autoSyncEnabled;
            if (syncFrequency) syncFrequency.value = syncFreq;
        });

    </script>
</body>
</html